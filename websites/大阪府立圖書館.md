# 大阪府立圖書館（おおさかeコレクション）

大阪府立图书馆建设的数字档案平台"おおさかeコレクション"（Osaka e-Collection），收录了大阪府立中之岛图书馆所藏的贵重古籍、浮世绘、浄瑠璃本、医书等多种珍贵文献的数字化图像。

- 网站链接：https://da.library.pref.osaka.jp/
- 分享协议：因馆藏类别而异，部分资源可二次利用（需查阅各类别的具体条款）
- 涵盖 14 个以上专题馆藏，包含数千件数字化资源
- 资源类型：浮世绘（锦绘）、浄瑠璃本、近世小说（草双纸）、医学古籍、韩国古书（刊本）、近世出版物、行政文书、手稿等
- 支持 IIIF 协议，可使用 [bookget](https://github.com/deweizhu/bookget) 等工具下载
- 仅日文界面

## 搜索与浏览

- 搜索页面：https://da.library.pref.osaka.jp/content/crosssearch
- 高级搜索：https://da.library.pref.osaka.jp/content/advancedsearch/
- 支持关键词检索（空格分隔多个词），也支持按题名、著者、出版年等字段进行高级搜索
- 高级搜索的可用字段因所选馆藏类别而异
- 搜索结果可切换缩略图视图和列表视图，支持排序和筛选
- 无需注册登录

## 主要馆藏

| 馆藏名称 | 说明 | 数量 |
|---------|------|------|
| 锦绘（にしきえ） | 幕末到明治时期的大阪风景版画 | 约 250 点 |
| 玩具絵本（にんぎょうどう） | 玩具师川崎巨泉手绘写生帖 | - |
| 中之岛贵重书 | 中之岛图书馆指定贵重资料 | - |
| 韩国本（かんぽん） | 李朝刊本及写本 | - |
| 近世小说（草双纸） | 江户时代大众小说 | - |
| 浄瑠璃本 | 江户时期浄瑠璃脚本 | 约 800 点 |
| 森田文库 | 开业医师所藏医学古籍 | - |
| 三井文库 | 中国医学古籍 | - |
| 石�的文库 | 前汉方医所藏人文类收藏 | - |

## 每本书能看到什么

| 字段 | 说明 | 示例 |
|------|------|------|
| 资料名 | 书名 | Abhandlung von dem Geldumlauf... |
| 著者 | 作者 | Johann Georg Büsch |
| 出版年 | 出版年代 | 1800 |
| 出版者 | 出版机构 | Bey Carl Ernst Bohn |
| 出版地 | 出版地点 | Hamburg und Kiel |
| 页数 | 总页数 | 916 p. |
| 大きさ | 尺寸 | 21 cm |
| 请求记号 | 架位号 | 337/B4/1-2 |
| 资料ID | 资源标识符 | 04-0000734 |
| 书志ID | 书目编号 | B11235158 |

- 每件资源配有 OpenSeadragon 高清图像查看器，支持缩放、旋转、亮度/对比度调节
- 支持全屏浏览
- 可下载图片（每次最多下载 50 页）
- 无全文文字（OCR）

## 示例

- 详情页：https://da.library.pref.osaka.jp/content/detail/04-0000734
- IIIF Manifest：https://da.library.pref.osaka.jp/api/items/04-0000734/manifest.json

---

# 开发者文档

## URL 结构

### 详情页
```
https://da.library.pref.osaka.jp/content/detail/{item_id}
```
- `item_id`：资源标识符，如 `04-0000734`，格式为 `{类别编号}-{序号}`

### 搜索页面
```
https://da.library.pref.osaka.jp/content/crosssearch              # 简单搜索
https://da.library.pref.osaka.jp/content/advancedsearch/           # 高级搜索
https://da.library.pref.osaka.jp/content/advancedsearch/{category} # 按类别高级搜索
```

### IIIF Manifest
```
https://da.library.pref.osaka.jp/api/items/{item_id}/manifest.json
```
- 例如：`https://da.library.pref.osaka.jp/api/items/04-0000734/manifest.json`

### IIIF Image API（单页图片）
```
https://da.library.pref.osaka.jp/api/contents/{uuid}.jp2/info.json
```
- 图片使用 JPEG 2000（.jp2）格式存储
- `uuid` 为每页图片的唯一标识（UUID 格式）

## 搜索 API

无公开的 JSON 搜索 API 文档。需通过页面 HTML 进行搜索。

大阪府立图书馆提供以下 Web API：
- Web-OPAC（蔵書検索）：`/opw/`、`/ops/`
- おおさかeコレクション的搜索结果直接通过页面渲染

## 元数据获取

### 通过 IIIF Manifest

请求 manifest JSON 即可获取基本元数据：

```
GET https://da.library.pref.osaka.jp/api/items/{item_id}/manifest.json
```

manifest 中包含 `metadata` 数组和 `label` 字段。

### 通过 HTML 解析

详情页采用服务端渲染，元数据在 HTML 中以表格形式呈现，可直接解析。

### 字段映射

| 中文字段 | 提取方式 |
|---------|---------|
| 资料名 | IIIF Manifest `label` / HTML 详情页 |
| 图片列表 | IIIF Manifest `sequences[0].canvases[*].images[0].resource` |
| 图片服务 | IIIF Manifest `sequences[0].canvases[*].images[0].resource.service.@id` |
| 其他元数据 | IIIF Manifest `metadata` 数组 / HTML 解析 |

## 下载

### IIIF 下载（推荐）

おおさかeコレクション支持 IIIF，这是获取图像的首选方式。

**从 Manifest 到图片 URL：**

1. 获取 manifest：`https://da.library.pref.osaka.jp/api/items/{item_id}/manifest.json`
2. 解析 `sequences[0].canvases[]`
3. 提取每个 canvas 的 `images[0].resource.service.@id`（格式为 `.jp2` 图片路径）
4. 拼接 IIIF Image API 参数下载：`{service_id}/full/full/0/default.jpg`

**图片格式：** 服务端存储为 JPEG 2000（.jp2），通过 IIIF Image API 可转换为 JPEG 输出。

**页面下载功能：** 网站自带下载功能，每次可下载 1-50 页，部分资源不可下载。

### bookget 支持

bookget IIIF wiki 页面已收录此站点。可通过 IIIF 标准接口下载：
- 相关源码：https://github.com/deweizhu/bookget/blob/main/app/iiif.go
- bookget wiki：https://github.com/deweizhu/bookget/wiki/05.IIIF%E6%A0%87%E5%87%86%E7%BD%91%E7%AB%99URL
- 用法示例：
  ```
  bookget "https://da.library.pref.osaka.jp/api/items/04-0000734/manifest.json"
  ```

### 图片保护

- 无水印（部分馆藏待确认）
- 无 Token/Cookie 认证要求
- OpenSeadragon 查看器使用 IIIF Image API 加载分块图片
