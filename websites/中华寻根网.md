# 中华寻根网

中国国家图书馆与澳门基金会合作建设的中华族谱服务平台，2011年上线，提供族谱全文影像浏览、姓氏源流查询、族谱编修互动等服务。

- 网站链接：http://ouroots.nlc.cn/
- 分享协议：免费开放浏览
- 约 2,000+ 部族谱、500+ 个姓氏源流、6,000+ 种其他文献
- 资源类型：家谱、族谱、姓氏源流
- 不支持 IIIF 协议
- 支持 [bookget](https://github.com/deweizhu/bookget) 下载

## 搜索与浏览

- 族谱文化页面：http://ouroots.nlc.cn/genealogyCulture.html
- 支持按姓氏、地区搜索族谱
- 可按姓氏源流浏览
- 无需注册登录

## 每本书能看到什么

| 字段 | 说明 | 示例 |
|------|------|------|
| 题名 | 族谱名称 | 蕭山湘南韓氏家譜 |
| 姓氏 | 所属姓氏 | 韓 |
| 地区 | 族谱所属地区 | 待确认 |
| 卷册 | 分卷信息 | 待确认 |

提供逐页影像在线浏览。

## 示例

- 族谱阅读页：http://ouroots.nlc.cn/view.html?41510488-2-1-1-%E8%95%AD%E5%B1%B1%E6%B9%98%E5%8D%97%E9%9F%93%E6%B0%8F%E5%AE%B6%E8%AD%9C-SZJP00001

---

# 开发者文档

## URL 结构

### 阅读页
```
http://ouroots.nlc.cn/view.html?{book_id}-{volume}-{page}-{unknown}-{title}-{collection_id}
```
- `book_id`：书目 ID（数字）
- 后续参数包含卷、页、题名（URL 编码的中文）、馆藏 ID

## 搜索 API

待确认。

## 元数据获取

### 卷册列表 API
```
GET http://dsnode.ouroots.nlc.cn/gtService/data/catalogVolume?bookId={book_id}
```
返回卷册元数据和分页信息。

## 下载

### bookget 支持

bookget 通过 `app/ouroots.go` 支持此网站。

关键 API 端点：
1. **卷册目录**：`http://dsnode.ouroots.nlc.cn/gtService/data/catalogVolume` — 获取卷册结构和页数
2. **匿名认证**：`http://dsNode.ouroots.nlc.cn/loginAnonymousUser` — 获取访问令牌
3. **图片获取**：`http://dsnode.ouroots.nlc.cn/data/catalogImage` — 返回 Base64 编码的 JPEG 图片

下载流程：
1. 从 URL 提取 book_id（正则：`(?i)\.html\?([A-z0-9]+)`）
2. 获取卷册结构和页数
3. 调用匿名认证接口获取 token
4. 逐页请求图片数据（返回 `data:image/jpeg;base64,...` 格式）
5. 解码 Base64 保存为 JPEG 文件
6. 请求间隔 40ms 避免限流

相关源码：
- https://github.com/deweizhu/bookget/blob/main/app/ouroots.go
