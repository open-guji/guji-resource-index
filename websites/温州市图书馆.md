# 温州市图书馆（瓯越记忆）

温州市图书馆建设的"瓯越记忆"数字资源平台，提供温州地方古籍的在线阅读与PDF下载，是国内地方古籍数字化的代表性项目之一。

- 网站链接：https://oyjy.wzlib.cn/pdf/ （旧版瓯越记忆）/ https://arcgxhpv7cw0.db.wzlib.cn/search.html （新版）
- 分享协议：未明确标注开放协议
- 约 1440 种 4029 册古籍（2024年第九次全国古籍数字资源联合发布数据）
- 资源类型：善本、地方志、温州地方特色文献
- 不支持 IIIF 协议
- 资源格式：PDF

## 搜索与浏览

- 旧版搜索页面：https://oyjy.wzlib.cn/pdf/
- 新版搜索页面：https://arcgxhpv7cw0.db.wzlib.cn/search.html
- 无需注册登录即可浏览和下载
- 网站为 SPA 单页应用，WebFetch 无法直接抓取页面内容

## 示例

- 旧版详情页：https://oyjy.wzlib.cn/resource/?id=62c6c1b0417eaa3687cb08bf
- 旧版详情页：https://oyjy.wzlib.cn/resource/?id=61e4c764505415b2e6921e5e
- 新版详情页：https://arcgxhpv7cw0.db.wzlib.cn/detail.html?id=200738&isTopic=1
- 新版详情页：https://arcgxhpv7cw0.db.wzlib.cn/detail.html?id=530050&isTopic=1

---

# 开发者文档

## 平台概述

温州市图书馆有两套数字化平台：
1. **旧版"瓯越记忆"**（oyjy.wzlib.cn）：独立开发的 SPA 应用
2. **新版平台**（arcgxhpv7cw0.db.wzlib.cn）：较新的检索系统

两套系统均为 SPA 单页应用，HTML 页面本身不含数据，需通过后端 API 获取。

## URL 结构

### 旧版（瓯越记忆）
```
https://oyjy.wzlib.cn/resource/?id={book_id}
```
- `book_id`：MongoDB 风格的文档 ID（如 `62c6c1b0417eaa3687cb08bf`）

### 新版
```
https://arcgxhpv7cw0.db.wzlib.cn/detail.html?id={book_id}&isTopic=1
```
- `book_id`：数字 ID（如 `200738`）

## API 端点

### 旧版 API（oyjy.wzlib.cn）

**单册资源详情：**
```
GET https://oyjy.wzlib.cn/api/search/v1/resource/{book_id}
```

**多卷册关联资源：**
```
GET https://oyjy.wzlib.cn/api/search/v1/resource_related/{book_id}
```

### 新版 API

**资源详情：**
```
GET https://{host}/search/juhe_detail/{book_id}/true?Flag=s
```

响应中包含 `WzlPdfUrl` 字段，指向 PDF 文件路径。相对路径需拼接 `https://db.wzlib.cn` 前缀。

## 下载

### bookget 支持

bookget 已支持温州市图书馆两套平台，源码位于：
- https://github.com/deweizhu/bookget/blob/main/app/wzlib.go

**下载逻辑：**
1. 从 URL 中用正则 `(?i)id=([A-z0-9_-]+)` 提取 book_id
2. 根据域名判断调用旧版或新版 API
3. 从 API 响应 JSON 中提取 PDF URL 列表（`WzlPdfUrl` 字段）
4. 对相对路径 URL 提取文件名部分，用正则 `file=(\S+)` 匹配，拼接 `https://db.wzlib.cn` 前缀
5. 使用 `gohttp.FastGet()` 多线程并发下载 PDF 文件
6. 支持页码范围过滤（`PageRange`）和已下载文件跳过

**下载格式：** PDF（非图片切片）

**认证要求：** 支持 Cookie 传入，但一般无需登录即可下载

### 直接下载

无需特殊认证，PDF 文件可直接通过 HTTP GET 下载。无水印、Referer 校验等保护措施的明确记录。
