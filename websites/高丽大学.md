# 高丽大学海外韩国学资料中心（Korea University Overseas Korean Studies Materials Center）

<!--
  本文件分两部分：
  - 分割线以上：用户文档，面向普通用户，语言简洁易懂，不含技术细节
  - 分割线以下：开发者文档，面向程序员，包含 API、HTML 解析、下载逻辑等技术细节
-->

高丽大学海外韩国学资料中心（해외한국학자료센터）由韩国高丽大学民族文化研究院运营，致力于收集、数字化和整理散布在海外的韩国学相关古文献资料。网站汇集了来自世界各地机构收藏的韩国古书、古文书、地图等珍贵文献的数字化影像，是研究海外韩国学资料的重要平台。

- 网站链接：http://kostma.korea.ac.kr/
- 分享协议：数字化资料供学术研究使用，具体条款见高丽大学规定
- 收录大量海外收藏的韩国古文献（具体数量随持续更新变化）
- 资源类型：古书、古文书、古地图、拓本、绘画、写真等
- 不支持 IIIF 协议

## 搜索与浏览

- 搜索页面：http://kostma.korea.ac.kr/search/list/
- 输入关键词即可搜索（支持韩文、汉字、英文）
- 搜索结果可按以下维度筛选：
  - 四部分类（经部、史部、子部、集部）
  - 资料类型（古书、古文书等）
  - 海外收藏机构
  - 语言
- 可按目录浏览：http://kostma.korea.ac.kr/dir/list
- 可浏览海外收藏机构列表：http://kostma.korea.ac.kr/knowledge/knowList
- 提供学术论文和目录集：http://kostma.korea.ac.kr/knowledge/thesisList
- 支持韩文、英文、中文、日文四种界面语言
- 无需注册登录

## 每本书能看到什么

| 字段 | 说明 | 示例 |
|------|------|------|
| 서명 | 书名 | 周易 |
| UCI | 统一内容标识符 | RIKS+CRMA+KSM-WZ.0000.0000-20090715.AS_BC_485 |
| 저자 | 作者 | (清)蔣廷錫 |
| 간행년 | 出版年 | 清雍正4年 |
| 판종 | 版种 | 木版本 |
| 소장기관 | 收藏机构 | 奥古拉文库 |
| 분류 | 分类 | 经部 |

- 可在线浏览古文献的数字化影像
- 提供逐页翻阅功能
- 无 PDF 直接下载
- 无全文 OCR 文字

## 示例

- 文献详情/阅览：http://kostma.korea.ac.kr/viewer/viewerDes?uci=RIKS+CRMA+KSM-WZ.0000.0000-20090715.AS_BC_485
- 资料目录浏览：http://kostma.korea.ac.kr/dir/list
- 海外收藏机构列表：http://kostma.korea.ac.kr/knowledge/knowList

---

# 开发者文档

## URL 结构

### 文献阅览页
```
http://kostma.korea.ac.kr/viewer/viewerDes?uci={uci}
```
- `uci`：统一内容标识符（Universal Content Identifier）
- 格式：`RIKS+CRMA+KSM-WZ.0000.0000-{date}.{collection_code}`
- 注意：URL 中 `+` 号代表空格

### 资料目录列表
```
http://kostma.korea.ac.kr/dir/list?uci={uci}
```

### 搜索
```
http://kostma.korea.ac.kr/search/list/?q={keyword}&fq={facet_field}:{value}&page={page}
```
- `q`：搜索关键词
- `fq`：筛选条件（如 `사부분류_fct:경부`）
- `page`：页码

## 搜索 API

无公开 REST API，需通过页面表单搜索。搜索参数通过 URL 查询字符串传递：

```
http://kostma.korea.ac.kr/search/list/?q={keyword}&fq=사부분류_fct:{category}&fq=유형분류_fct:{type}&page=1
```

筛选维度参数名：
- `사부분류_fct`：四部分类
- `유형분류_fct`：资料类型分类

## 元数据获取

阅览页为混合渲染页面，图片信息通过 JavaScript 变量传递。

关键数据提取：
- 页面中嵌入 JavaScript 变量 `bookInfos`，包含书籍元数据和图片信息
- `bookInfos` 包含 `BookPath` 和 `Fname` 字段，用于构造图片 URL

### 字段映射

| 中文字段 | 提取方式 |
|---------|---------|
| 书名 | HTML 解析或 `bookInfos` 对象 |
| UCI | URL 参数 `uci` |
| 作者 | HTML 解析 |
| 出版年 | HTML 解析 |
| 收藏机构 | HTML 解析 |

## 下载

### bookget 支持

bookget 支持高丽大学海外韩国学资料中心的图片下载。

- 源码：https://github.com/deweizhu/bookget/blob/main/app/korea.go
- 支持的 URL 格式：
  ```
  http://kostma.korea.ac.kr/viewer/viewerDes?uci=RIKS+CRMA+KSM-WZ.0000.0000-20090715.AS_BC_485
  ```

#### 下载流程（基于 bookget 源码分析）

1. **提取文献标识**：从 URL 中提取 `uci` 参数，正则：`uci=([^&]+)`

2. **获取图片信息**：
   - 访问阅览页面 HTML
   - 提取 JavaScript 变量 `bookInfos` 中的图片元数据
   - 获取 `BookPath`（图片路径）和 `Fname`（文件名）字段

3. **构造图片 URL**：
   ```
   {scheme}://{host}/data/des/{bookId}/IMG/{path}/{filename}
   ```
   - 基础图片目录：`/data/des/{bookId}/IMG/`
   - 完整路径：`ossHost + imgPath + "/" + filename`

4. **下载图片**：
   - 多线程下载，使用工作队列
   - 单张图片并发数为 1
   - 跳过已存在的文件
   - 文件命名：零填充格式（如 `0001.jpg`）

#### 必需的 HTTP 请求头

| 请求头 | 值 | 说明 |
|--------|-----|------|
| User-Agent | 自定义浏览器 UA | 必须设置 |
| Cookie | 会话 Cookie | 通过 Cookie Jar 维护 |

### 注意事项

- 不支持 IIIF 协议
- 图片路径信息嵌入在 JavaScript 变量中，需解析 HTML 提取
- 建议设置请求间隔（sleep），避免触发限流
- 网站同时支持韩文/英文/中文/日文界面，但 API 结构相同
