# 市立米泽图书馆数字图书馆

<!--
  本文件分两部分：
  - 分割线以上：用户文档，面向普通用户，语言简洁易懂，不含技术细节
  - 分割线以下：开发者文档，面向程序员，包含 API、HTML 解析、下载逻辑等技术细节
-->

日本山形县市立米泽图书馆（市立米沢図書館）建设的数字图书馆，提供馆藏古典籍的数字影像。米泽图书馆创建于明治42年（1909），基础藏书来自米泽藩藩校�的兴让馆（興譲館）传承的和书与汉籍，其中包含战国名将直江兼续收集的珍贵书籍。馆藏古典籍超过 4 万册，经专家鉴定的"米泽善本"208 部尤为珍贵。

- 数字图书馆：https://www.library.yonezawa.yamagata.jp/dg/
- 收藏文化财总合数据库（与上杉博物馆合建）：https://www.denkoku-no-mori.yonezawa.yamagata.jp/togodb/
- 图书馆主页：https://www.library.yonezawa.yamagata.jp/wordp/
- 分享协议：学术研究用途（具体条款参见网站）
- 约 442 件数字化资料（含米泽善本 208 部）
- 资源类型：和书、汉籍善本、古文书、藩校教材、上杉�的山注释本等
- 不支持 IIIF 协议
- 可使用 [bookget](https://github.com/deweizhu/bookget) 下载

## 搜索与浏览

数字图书馆提供三种浏览方式：

- 数字图书馆入口：https://www.library.yonezawa.yamagata.jp/dg/
- **按五十音排列**：按日语假名音序浏览书名
- **按收藏分类**：
  - 善本（米泽善本 208 部）
  - 兴让馆文库（藩校传承书籍）
  - 上杉鹰山注释本
  - 临泉文库
  - 乡土资料
- **按主题分类**：30 余个类别，包括中国经典、历史、医学、诗文、艺术、乡土记录等
- 站内搜索：使用 Google 自定义搜索
- 无需注册登录

### 收藏文化财总合数据库

米泽市上杉博物馆与市立米泽图书馆联合建设的文化财总合数据库：
- 入口：https://www.denkoku-no-mori.yonezawa.yamagata.jp/togodb/
- 可检索两馆收藏的文化财信息

## 每本书能看到什么

| 字段 | 说明 | 示例 |
|------|------|------|
| 书名 | 资料题名 | 毛詩疏 |
| 册数 | 总卷册数 | 10册 |
| 分类 | 所属类别 | 善本 / 兴让馆文库 |
| 影像 | 逐页彩色扫描图 | JPEG 格式 |

- 提供逐页彩色影像浏览，支持缩放（wheelzoom）
- 部分资料提供影像 PDF 文件和翻刻 PDF 文件（文字版）
- 支持翻页、首页/末页跳转、缩放、全屏查看
- 无 OCR 全文文字（部分有翻刻 PDF）

## 示例

- 毛詩疏（善本）：https://www.library.yonezawa.yamagata.jp/dg/AA001_view.html
- 第二部资料：https://www.library.yonezawa.yamagata.jp/dg/AA002_view.html

---

# 开发者文档

## URL 结构

### 资料查看页
```
https://www.library.yonezawa.yamagata.jp/dg/{book_id}_view.html
```
- `book_id`：资料标识符，如 `AA001`、`AA002` 等
- 格式为：两位字母前缀 + 三位数字序号

### 影像文件
```
https://www.library.yonezawa.yamagata.jp/dg/data/{book_id}/{volume}/{book_id}_{page}.jpg
```
- `book_id`：如 `AA001`
- `volume`：卷册编号，三位数字如 `001`
- `page`：页码，三位数字如 `001`
- 完整示例：`data/AA001/001/AA001_001.jpg`

### 影像目录变量
页面中的 JavaScript 变量 `var dir='data/{book_id}/'` 指定影像文件根目录。

## 搜索 API

无公开 API。站内搜索基于 Google Custom Search。数字图书馆首页为静态 HTML 列表页面。

## 元数据获取

### 页面解析

查看页（`*_view.html`）为传统服务端渲染的 HTML 页面，关键数据可从以下方式获取：

1. **JavaScript 变量解析**：
   - `var dir='data/{book_id}/'`：影像文件目录路径
   - 页面中的 `<option>` 标签：包含各卷册/页面的列表

2. **HTML 解析**：
   - `<option>` 标签列表中提取所有可用页面
   - 页面元数据可能包含在 HTML 头部或正文中

### 字段映射

| 中文字段 | 提取方式 |
|---------|---------|
| 书名 | HTML 页面标题或 `<h1>` 等标签 |
| 页面列表 | `<select>` 中的 `<option>` 标签 |
| 影像目录 | JavaScript 变量 `var dir=` |
| 图片尺寸 | JavaScript 变量（宽 1612、高 1264 像素，显示宽度 750） |

## 下载

### bookget 支持

bookget 有专门的 `yonezawa.go` 源码支持此网站：
- 源码：https://github.com/deweizhu/bookget/blob/main/app/yonezawa.go

**bookget 下载逻辑（基于 yonezawa.go 分析）：**

1. **URL 解析**：使用正则 `/([A-z\d_-]+)_view.html` 从 URL 提取 `book_id`（如 `AA001`）
2. **获取页面列表**：
   - 请求查看页 HTML
   - 解析所有 `<option>` 标签获取卷册/页面列表
   - 提取 JavaScript 变量 `var dir='data/{book_id}/'` 获取影像目录
3. **构建图片 URL**：
   - 从 ID 中提取目录部分（第5-8位字符）和书籍标识（第0-8位字符）
   - 页码补零格式化
   - 拼接为 `{host}{imageDir}{dir2}/{book}_{sortId}.jpg`
4. **并发下载**：
   - 使用队列机制并发下载
   - 支持配置线程数
   - 跳过已存在的文件

**bookget wiki URL 格式：**
```
https://www.library.yonezawa.yamagata.jp/dg/AA001_view.html
https://www.library.yonezawa.yamagata.jp/dg/AA002_view.html
```

### 手动下载

图片为标准 JPEG 文件，URL 规律明确：
```
https://www.library.yonezawa.yamagata.jp/dg/data/{book_id}/{volume}/{book_id}_{page}.jpg
```

可编写简单脚本遍历页码下载。

### 注意事项

- 不支持 IIIF，无 manifest
- 图片为 JPEG 格式，尺寸约 1612 x 1264 像素
- 需设置 User-Agent 和 Referer（URL 编码后的来源页面）请求头
- 支持 Cookie jar 保持会话
- 使用 wheelzoom 前端查看器，图片在客户端缩放
- 部分资料有翻刻 PDF（文字版），可单独下载
- 数字化项目由公益财团法人图书馆振兴财团资助（2012-2013年度）
