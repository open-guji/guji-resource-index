# 牛津大学博德利图书馆（Digital Bodleian）

<!--
  本文件分两部分：
  - 分割线以上：用户文档，面向普通用户，语言简洁易懂，不含技术细节
  - 分割线以下：开发者文档，面向程序员，包含 API、HTML 解析、下载逻辑等技术细节
-->

牛津大学博德利图书馆（Bodleian Library）是英国最古老的公共图书馆之一，其数字化平台 Digital Bodleian 提供超过百万张数字化图像。中文古籍方面，馆藏约 7000 种中文古籍，其中"中文地图、手稿与印刷书籍"专题收录了 2000 余件数字化藏品，涵盖 17 世纪以来入藏的善本、手稿、地图、传教士文献等，是欧洲最重要的中文古籍收藏之一——据估计，17 世纪传入欧洲的中文书籍中，约四分之一收藏于此。

- 网站链接：https://digital.bodleian.ox.ac.uk/
- 中文专题：https://digital.bodleian.ox.ac.uk/collections/chinese/
- 中文古籍目录（原 Serica，现 East Asian Catalogue）：https://east-asian.bodleian.ox.ac.uk/
- 分享协议：[CC BY-NC 4.0](https://creativecommons.org/licenses/by-nc/4.0/)（大部分藏品；部分牛津学院藏品可能有不同限制，需逐件查看）
- 约 2000+ 件中文数字化藏品
- 资源类型：善本、手稿、地图、道教抄本、传教士文献、民主墙出版物等
- 支持 IIIF 协议（Presentation API v2/v3，Image API v2），可使用 [bookget](https://github.com/deweizhu/bookget) 等工具下载
- 无需注册登录即可浏览和下载

## 搜索与浏览

- 搜索页面：https://digital.bodleian.ox.ac.uk/search/
- 在搜索框输入关键词即可搜索，支持高级搜索
- 可在中文专题页面直接浏览：https://digital.bodleian.ox.ac.uk/collections/chinese/
- 搜索结果可按以下维度筛选：收藏（Collection）、数字化项目（Digitization Project）、语言（Language）、持有机构（Holding Institution）等
- 无需注册登录

**中文古籍专用目录（East Asian Catalogue）：**

- 地址：https://east-asian.bodleian.ox.ac.uk/（原 serica.bodleian.ox.ac.uk 已重定向）
- 专门针对博德利图书馆及牛津各学院的东亚手稿与善本
- 收录范围：1912 年以前的中文印刷品（木刻、石印、活字）、中日韩手稿与卷轴
- 搜索建议使用繁体字以获得准确结果
- 可按"对象（Objects）"、"作品（Works）"、"人物（People）"、"主题（Subjects）"四个维度浏览

## 每本书能看到什么

| 字段 | 说明 | 示例 |
|------|------|------|
| Shelfmark | 馆藏编号 | Bodleian Library Arch.O.a.6/1 |
| Language | 语言 | Chinese |
| Collection | 所属收藏 | Chinese Maps, Manuscripts and Printed Books |
| Digitization Project | 数字化项目 | Chinese Collections Digitization Project (2014-2021) |
| Holding Institution | 持有机构 | Bodleian Libraries, University of Oxford |
| Record Created | 记录创建时间 | 2016-08-30 |
| Attribution | 版权声明 | Photo: (C) Bodleian Libraries, University of Oxford. Terms of use: CC BY-NC 4.0 |

- 可在线逐页翻阅高清图像，阅读器支持缩放、旋转等操作
- 可直接下载 JPEG 或 PDF 格式图像（博德利持有版权的藏品提供最高分辨率下载）
- 无全文文字（OCR），仅提供图像
- 阅读方向为从右到左（适合中文古籍竖排阅读）

## 示例

- 详情页（古籍 Arch.O.a.6/1）：https://digital.bodleian.ox.ac.uk/objects/310cb04e-6bce-44e3-85b5-03417c9644a8/
- 详情页（手稿 MS.Chin.d.77）：https://digital.bodleian.ox.ac.uk/objects/878bf2d0-8e83-4a68-b4a1-16e59a98eb28/
- 中文地图手稿专题浏览：https://digital.bodleian.ox.ac.uk/collections/chinese/
- 赛尔登中国地图（Selden Map）：https://digital.bodleian.ox.ac.uk/objects/7b18aa78-05f3-47af-a4af-66987ebc3c39/

---

# 开发者文档

## URL 结构

### 详情页
```
https://digital.bodleian.ox.ac.uk/objects/{uuid}/
```
- `uuid`：作品的 UUID v4 标识符，如 `310cb04e-6bce-44e3-85b5-03417c9644a8`

### IIIF Manifest
```
https://iiif.bodleian.ox.ac.uk/iiif/manifest/{uuid}.json
```
- `uuid` 与详情页相同
- 默认返回 Presentation API v2.1 格式
- 请求 v3 格式需设置 Accept 头：`application/ld+json;profile="http://iiif.io/api/presentation/3/context.json"`

### IIIF Image API
```
https://iiif.bodleian.ox.ac.uk/iiif/image/{image-uuid}/{region}/{size}/{rotation}/{quality}.{format}
```
- `image-uuid`：单张图片的 UUID（从 manifest 的 canvas 中获取）
- 遵循 IIIF Image API 2.0 规范，level1 兼容
- 示例（获取全尺寸 JPEG）：`https://iiif.bodleian.ox.ac.uk/iiif/image/{image-uuid}/full/full/0/default.jpg`
- 示例（指定宽度 1024）：`https://iiif.bodleian.ox.ac.uk/iiif/image/{image-uuid}/full/1024,/0/default.jpg`
- info.json：`https://iiif.bodleian.ox.ac.uk/iiif/image/{image-uuid}/info.json`

### 嵌入页面
```
https://digital.bodleian.ox.ac.uk/embed/iframe/?url=https://digital.bodleian.ox.ac.uk/objects/{uuid}/
```

### East Asian Catalogue（原 Serica）
```
https://east-asian.bodleian.ox.ac.uk/
https://east-asian.bodleian.ox.ac.uk/search_results?name={关键词}
```
- 原域名 `serica.bodleian.ox.ac.uk` 已 301 重定向至 `east-asian.bodleian.ox.ac.uk`

## 搜索 API

Digital Bodleian 是 SPA 应用，搜索页面本身不含数据。平台提供两种开发者 API：

1. **Data API**：https://digital.bodleian.ox.ac.uk/developer/data/
   - 提供 ReDoc 格式的 OpenAPI 文档（页面为 SPA，需浏览器查看）
   - 不提供 OAI-PMH 导出

2. **IIIF API**：https://digital.bodleian.ox.ac.uk/developer/iiif/
   - 提供 ReDoc 格式的 OpenAPI 文档
   - IIIF 根端点：`https://iiif.bodleian.ox.ac.uk/`（返回顶层 IIIF 资源链接的 JSON）
   - 支持 Activity Streams 用于批量获取 manifest

**注意**：API 文档页面使用 ReDoc 渲染 OpenAPI 规范，需在浏览器中查看完整内容，直接抓取 HTML 无法获取实际 API 定义。

## 元数据获取

### 方式一：IIIF Manifest（推荐）

从 IIIF Manifest JSON 中提取元数据，这是最可靠的方式。

请求示例：
```
GET https://iiif.bodleian.ox.ac.uk/iiif/manifest/310cb04e-6bce-44e3-85b5-03417c9644a8.json
```

### 字段映射

| 中文字段 | JSON 路径（Presentation API v2） |
|---------|-------------------------------|
| 题名 | `label` |
| 描述 | `description` |
| 馆藏编号 | `metadata[?(@.label=="Shelfmark")].value` |
| 语言 | `metadata[?(@.label=="Language")].value` |
| 所属收藏 | `metadata[?(@.label=="Collection")].value` |
| 数字化项目 | `metadata[?(@.label=="Digitization Project")].value` |
| 持有机构 | `metadata[?(@.label=="Holding Institution")].value` |
| 记录创建时间 | `metadata[?(@.label=="Record Created")].value` |
| 版权声明 | `attribution` |
| 授权协议 | `license` |
| 主页链接 | `metadata[?(@.label=="Homepage")].value`（含 HTML 链接） |

### 方式二：详情页 HTML

详情页为 SPA，HTML 中包含基本的 Schema.org 标记（`CreativeWork` 类型），但数据有限，不推荐此方式。

## 下载

### IIIF 下载流程

1. **获取 Manifest**：
   ```
   GET https://iiif.bodleian.ox.ac.uk/iiif/manifest/{uuid}.json
   ```

2. **解析 Canvas 列表**：
   - v2: `sequences[0].canvases[]`
   - 每个 canvas 包含 `label`（页面标签，如 "fol. 1r"）、`width`、`height`

3. **获取图片 URL**：
   - 从 canvas 的 `images[0].resource.service["@id"]` 获取 Image Service ID
   - 格式为：`https://iiif.bodleian.ox.ac.uk/iiif/image/{image-uuid}`

4. **下载图片**：
   - 全尺寸：`{service-id}/full/full/0/default.jpg`
   - 指定宽度：`{service-id}/full/{width},/0/default.jpg`
   - 深度缩放：先获取 `{service-id}/info.json`，再使用 dezoomify-rs 拼接

### bookget 支持

bookget 通过 `oxacuk.go` 支持 Digital Bodleian：
- 源码：https://github.com/deweizhu/bookget/blob/main/app/oxacuk.go
- 输入 URL 格式：`https://digital.bodleian.ox.ac.uk/objects/{uuid}/`
- 实现逻辑：
  1. 从页面 HTML 中用正则提取 manifest URL（模式：`https://(.+)/manifest.json`）
  2. 请求 manifest JSON，解析 sequences → canvases
  3. 支持两种下载模式：
     - **普通模式**：直接下载 JPEG 图片
     - **Dezoomify 模式**（`UseDzi`）：获取 `info.json` 后通过 dezoomify-rs 下载高分辨率图片
  4. 支持多卷册处理、页码范围过滤
  5. 并发下载，文件名零填充排序（如 `0001.jpg`）

### HTTP 请求头

- `User-Agent`：自定义（bookget 使用可配置 UA）
- `Referer`：`https://digital.bodleian.ox.ac.uk/objects/{uuid}/`（URL 编码）
- 无需认证 Cookie 或 Token
- 无水印、无 Referer 校验限制（CC BY-NC 4.0 许可下的公开访问）

### 注意事项

- 大量批量下载 manifest 时，建议联系 Digital Bodleian 团队协调
- 部分牛津学院藏品可能有不同于 CC BY-NC 4.0 的许可限制，需逐件检查 manifest 中的 `license` 字段
- Image API 为 level1 兼容，部分高级参数（如任意区域裁剪）可能不完全支持
- 网站偶有性能问题（"Images may be slow to load"），建议适当控制并发数
