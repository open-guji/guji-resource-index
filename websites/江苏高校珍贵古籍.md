# 江苏高校珍贵古籍资源库

江苏省高等学校图书情报工作委员会牵头，南京大学图书馆联合省内八所高校图书馆共同建设的古籍全文影像数据库，是国内首个全省高校携手共建的珍贵古籍全文图像联合数据库。

- 网站链接：https://jsgxgj.nju.edu.cn/
- 分享协议：待确认
- 第一期收录 95 部珍贵古籍，共 836 册，100,049 页影像
- 资源类型：善本古籍（含宋元明清各朝代珍贵版本）
- 不支持 IIIF 协议（使用 Deep Zoom 瓦片图方式提供影像）
- 支持 [bookget](https://github.com/deweizhu/bookget) 下载

## 搜索与浏览

- 主页面：https://jsgxgj.nju.edu.cn/#/resource/home
- 提供古籍目录的检索和浏览功能
- 可按收藏单位（参建高校）浏览古籍
- 每部古籍附有 6 张代表性页面图片，可用于版本比对
- **需要注册登录**：需使用手机号注册个人账户，并在校园网 IP 范围内登录，方可浏览古籍全文影像；校外访问需通过所在学校的 VPN

## 参建单位

1. 南京大学图书馆
2. 南京师范大学图书馆
3. 南京中医药大学图书馆
4. 苏州大学图书馆
5. 扬州大学图书馆
6. 江苏师范大学图书馆
7. 淮阴师范学院图书馆
8. 南京农业大学图书馆

## 每本书能看到什么

| 字段 | 说明 | 示例 |
|------|------|------|
| 题名 | 书名 | 待确认 |
| 著者 | 作者/编者 | 待确认 |
| 卷册数 | 分卷/分册信息 | 待确认 |
| 影像描述 | 页面图片说明 | 待确认 |
| 收藏单位 | 藏书高校 | 南京大学图书馆 |

- 可在线逐页浏览古籍全文影像
- 支持画线、做笔记、添加书签等互动功能
- 无 PDF 整本下载功能
- 无全文文字（OCR）

## 示例

- 详情页：https://jsgxgj.nju.edu.cn/#/resource/bookdetails?bookId=GJ-1668922900001
- 在线阅读：需登录后在详情页点击阅读

---

# 开发者文档

> 本站是 Vue SPA 单页应用，直接抓取 HTML 无法获得数据内容，需调用后端 API。

## URL 结构

### 主页（资源浏览）
```
https://jsgxgj.nju.edu.cn/#/resource/home
```

### 书籍详情页
```
https://jsgxgj.nju.edu.cn/#/resource/bookdetails?bookId={bookId}
```
- `bookId`：书籍唯一标识符，格式如 `GJ-1668922900001`

### 阅读页
```
https://jsgxgj.nju.edu.cn/#/resource/bookdetails?bookId={bookId}&typeId={typeId}
```
- `typeId`：卷册标识符，从书籍详情的子目录中获取

## 搜索 API

待确认。网站为 SPA 架构，搜索接口需通过浏览器开发者工具抓取。

## 元数据获取

本站为 SPA 应用，所有数据通过后端 JSON API 获取。以下 API 端点来自 bookget 源码逆向分析：

### 获取书籍详情
```
GET https://jsgxgj.nju.edu.cn/portal/book/getBookById?bookId={bookId}
```
响应结构（`njuedu.Detail`）：
```json
{
  "code": 200,
  "message": "...",
  "data": [
    {
      "id": "...",
      "bookId": "...",
      "num": 0,
      "attributeId": "...",
      "attributeValue": "...",
      "operator": "...",
      "operatorName": "...",
      "typeId": "...",
      "captions": "..."
    }
  ]
}
```
- 关键字段：`typeId`（用于获取卷册目录）

### 获取卷册目录
```
GET https://jsgxgj.nju.edu.cn/portal/book/getMasterSlaveCatalogue?typeId={typeId}&bookId={bookId}
```
响应结构（`njuedu.Catalog`）：
```json
{
  "code": 200,
  "message": "...",
  "data": [
    {
      "bookId": "...",
      "bookName": "...",
      "volumeNum": "...",
      "imgDescription": "...",
      "catalogues": [...]
    }
  ]
}
```

### 获取页面影像数据
```
GET https://jsgxgj.nju.edu.cn/portal/book/view?bookId={bookId}&typeId={typeId}
```
响应结构（`njuedu.Response`）：
```json
{
  "code": 200,
  "message": "...",
  "data": {
    "title": "...",
    "serverBase": "...",
    "images": ["page1.dzi", "page2.dzi", ...]
  }
}
```
- `serverBase`：瓦片图服务器路径前缀
- `images`：各页面对应的 DZI 文件路径列表

### 获取瓦片图配置
```
GET https://jsgxgj.nju.edu.cn/{serverBase}/tiles/infos.json
```
响应结构（`njuedu.ResponseTiles`）：
```json
{
  "page_key": {
    "extension": "jpg",
    "height": 3000,
    "width": 2000,
    "resolutions": [...],
    "tileSize": { "height": 256, "width": 256 },
    "tileSize2": { "height": 256, "width": 256 }
  }
}
```

### 字段映射

| 中文字段 | JSON 路径 |
|---------|---------|
| 书籍ID | `data[].bookId` (Detail API) |
| 类型ID | `data[].typeId` (Detail API) |
| 书名 | `data[].bookName` (Catalog API) |
| 卷册号 | `data[].volumeNum` (Catalog API) |
| 影像描述 | `data[].imgDescription` (Catalog API) |
| 页面标题 | `data.title` (Response API) |
| 服务器路径 | `data.serverBase` (Response API) |
| 页面列表 | `data.images` (Response API) |

## 下载

### bookget 支持

bookget 通过 `app/njuedu.go` 支持此网站。

关键逻辑：
1. 从 URL 中提取 `bookId`（正则：`(?i)bookId=([A-z0-9_-]+)`）
2. 调用 `/portal/book/getBookById` 获取 `typeId`
3. 调用 `/portal/book/getMasterSlaveCatalogue` 获取卷册目录
4. 遍历各卷册，调用 `/portal/book/view` 获取页面影像列表
5. 从 `/{serverBase}/tiles/infos.json` 获取瓦片图配置
6. 构造 DZI 清单（Deep Zoom Image），使用 Dezoomify 方式拼合瓦片下载完整页面图片
7. 页面按顺序编号保存（0001、0002、...）
8. 下载完成后清理临时瓦片文件

### 必需的 HTTP 请求头

```
Origin: https://jsgxgj.nju.edu.cn
Referer: https://jsgxgj.nju.edu.cn/
```

### 认证要求

- 使用 Cookie 维持会话（`cookiejar.Jar`）
- 需要手机号注册账户并登录后获取有效 Cookie
- 校外访问需通过 VPN

### 图片保护

- 影像以 Deep Zoom 瓦片图方式提供，不直接暴露完整图片 URL
- 需要正确的 Origin 和 Referer 头才能获取瓦片
- 其他保护措施（水印等）：待确认

相关源码：
- https://github.com/deweizhu/bookget/blob/main/app/njuedu.go
- https://github.com/deweizhu/bookget/blob/main/model/njuedu/njuedu.go
