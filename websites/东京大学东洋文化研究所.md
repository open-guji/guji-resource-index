# 东京大学东洋文化研究所（漢籍善本全文影像資料庫）

<!--
  本文件分两部分：
  - 分割线以上：用户文档，面向普通用户，语言简洁易懂，不含技术细节
  - 分割线以下：开发者文档，面向程序员，包含 API、HTML 解析、下载逻辑等技术细节
-->

东京大学东洋文化研究所（Institute for Advanced Studies on Asia, 東京大学東洋文化研究所）建设的「漢籍善本全文影像資料庫」，提供研究所所藏珍贵汉籍善本的全文影像。该研究所成立于 1941 年，是日本最重要的亚洲研究机构之一，所藏汉籍约 70,000 种，其中善本影像数据库收录约 3,889 部珍贵古籍的全文扫描图像。

- 网站链接：https://shanben.ioc.u-tokyo.ac.jp/
- 版权声明：版權所有 東京大學 東洋文化研究所（未经承诺禁止复制、再发布或贩卖）
- 约 3,889 部古籍（全文影像）
- 资源类型：汉籍善本（经、史、子、集四部分类）
- 不支持 IIIF 协议（善本数据库本身不支持；研究所另有基于 Omeka S 的 IIIF 项目 `iiif.ioc.u-tokyo.ac.jp`，但内容不同）
- 图片格式：黑白扫描影像，另提供 PDF 格式下载（品质更佳）
- 封面及书影提供彩色图像
- 无需注册登录，免费公开访问

## 搜索与浏览

- 浏览页面：https://shanben.ioc.u-tokyo.ac.jp/list.php
- 支持两种浏览方式：
  - **四部分類順序**：按传统经、史、子、集分类排列，可快速跳转到经/史/子/集/丛书各部
  - **書名筆畫順序**：按书名笔画排列
- 分类筛选：可选择「全部」「經」「史」「子」「集」「叢書」
- 搜索功能需通过关联的「漢籍目錄資料庫」（http://www3.ioc.u-tokyo.ac.jp/kandb.html ）进行检索，检索结果中带有「連結文本」图标的条目可链接到善本全文影像
- 无需注册登录

## 每本书能看到什么

| 字段 | 说明 | 示例 |
|------|------|------|
| 書名 | 书名 | 資治通鑑綱目五十九卷 |
| 拼音題名 | 拼音标注的书名 | zi1 zhi4 tong1 jian4 gang1 mu4 |
| 撰者 | 作者 | 朱熹 |
| 朝代 | 作者所属朝代 | 宋 |
| 著作方式 | 著述方式 | 撰 |
| 出版/刻書年 | 出版或刻印年代 | 成化九年序 |
| 出版/刻書地 | 出版或刻印地点 | （部分记录留空） |
| 出版/刻書者 | 出版或刻印者 | 內府 |
| 版種 | 版本类型 | 刊本 |
| 內容分類 | 四部分类 | 史-編年-通紀 |
| 索書號 | 馆藏索书号 | 史部-編年-12 |
| 函冊 | 装帧信息 | 10函59冊 |
| 編號 | 数据库编号 | B1333100 |

- 可在线逐页翻阅黑白扫描影像，支持放大/缩小
- 每卷可单独下载 PDF 文件（品质较高，文件大小约 5-40 MB/卷）
- 提供彩色封面/首页图像
- 无全文文字（OCR）
- 左侧树形目录可展开各卷册，方便跳转

## 示例

- 书目浏览页：https://shanben.ioc.u-tokyo.ac.jp/list.php
- 详情页（資治通鑑綱目）：https://shanben.ioc.u-tokyo.ac.jp/main_p.php?nu=B1333100&order=rn_no&no=00122
- 详情页（呂氏春秋）：https://shanben.ioc.u-tokyo.ac.jp/main_p.php?nu=C5613401&order=rn_no&no=00870
- 详情页（續增駁案新編）：https://shanben.ioc.u-tokyo.ac.jp/main_p.php?nu=B3852100&order=rn_no&no=00646
- 书目详细记录（重定向至 kanseki 子系统）：http://kanseki.ioc.u-tokyo.ac.jp/user/query_detail_im.php?nu=B1333100

## 相关资源

东洋文化研究所还提供以下数字资源（非善本影像数据库，但同属研究所）：

| 名称 | URL | 说明 |
|------|-----|------|
| 漢籍目錄資料庫 | http://www3.ioc.u-tokyo.ac.jp/kandb.html | 约 70,000 种汉籍的书目检索 |
| 雙紅堂文庫 | http://imglib.ioc.u-tokyo.ac.jp/ | 明清戏曲小说约 3,000 种的影像 |
| 鹽谷温博士 IIIF 档案 | https://iiif.ioc.u-tokyo.ac.jp/s/kanseki/page/shionoya | 元曲选全译稿（Omeka S + IIIF） |
| 中国绘画所在数据库 | http://cpdb.ioc.u-tokyo.ac.jp/ | 中国绘画收藏地点检索 |
| 亚洲电子图书馆总入口 | http://imglib.ioc.u-tokyo.ac.jp/ | 含梵文、阿拉伯文等写本 |

---

# 开发者文档

## URL 结构

### 书目浏览页

```
https://shanben.ioc.u-tokyo.ac.jp/list.php?query={query}&class={class}&order={order}&p={page}
```

- `query`：查询条件，`all` 表示全部
- `class`：分类筛选，可选 `all`（全部）、`經`、`史`、`子`、`集`、`叢書`
- `order`：排序方式，`rn_no`（四部分类顺序）或 `ti_no`（书名笔画顺序）
- `p`：页码，从 1 开始，每页约 20 条，共约 195 页

### 作品详情/阅读页

```
https://shanben.ioc.u-tokyo.ac.jp/main_p.php?nu={book_id}&order={order}&no={serial_no}
```

- `nu`：作品编号（如 `B1333100`、`C5613401`），字母开头 + 数字
- `order`：同上
- `no`：在列表中的序号（如 `00122`）

带图片浏览参数：

```
https://shanben.ioc.u-tokyo.ac.jp/main_p.php?nu={book_id}&order=rn_no&no={serial_no}&im={image_id}&pg={page}
```

- `im`：图片编号（如 `0010001`）
- `pg`：页码
- 可附加 `&size=big` 或 `&size=small` 控制图片大小

### 封面图片

```
https://shanben.ioc.u-tokyo.ac.jp/file/cover/500/{book_id}.jpg
```

- `book_id`：作品编号

### PDF 下载

```
https://shanben.ioc.u-tokyo.ac.jp/pdf/{pdf_id}-{书名}-{卷次}.pdf
```

- `pdf_id`：数字 ID（如 `002408`、`014806`）
- 书名和卷次为中文（URL 编码）
- 示例：`pdf/002408-資治通鑑綱目五十九卷成化九年序內府刊本-卷首.pdf`

### 书目详细记录（重定向）

```
https://shanben.ioc.u-tokyo.ac.jp/query_detail.php?nu={book_id}
```

会 302 重定向到：

```
http://kanseki.ioc.u-tokyo.ac.jp/user/query_detail_im.php?nu={book_id}
```

## 搜索 API

无公开搜索 API。善本影像数据库本身不提供搜索功能，只提供分类浏览。

搜索需通过关联的「漢籍目錄資料庫」进行：
- URL：http://www3.ioc.u-tokyo.ac.jp/kandb.html
- 该系统为传统 HTML 表单，无 JSON API

浏览列表可通过分页参数程序化遍历：

```
GET https://shanben.ioc.u-tokyo.ac.jp/list.php?query=all&class=all&order=rn_no&p={1..195}
```

## 元数据获取

### 方式一：从浏览列表页提取

列表页（`list.php`）为传统服务端渲染 HTML，每条记录包含：
- 序号
- 书名（链接到详情页，可提取 `nu` 参数）
- 内容分类
- 索书号

### 方式二：从详细记录页提取

通过 `query_detail.php?nu={book_id}`（重定向到 `kanseki.ioc.u-tokyo.ac.jp`）获取完整书目记录。

### 字段映射

| 中文字段 | 提取方式 |
|---------|---------|
| 書名 | 详情页 HTML 解析 |
| 拼音題名 | kanseki 详细记录页 |
| 撰者 | kanseki 详细记录页 |
| 朝代 | kanseki 详细记录页 |
| 著作方式 | kanseki 详细记录页 |
| 出版/刻書年 | kanseki 详细记录页 |
| 出版/刻書者 | kanseki 详细记录页 |
| 版種 | kanseki 详细记录页 |
| 內容分類 | list.php 列表页即可获取 |
| 索書號 | list.php 列表页即可获取 |
| 函冊 | kanseki 详细记录页 |
| 編號 (nu) | URL 参数，也在 kanseki 详细记录页 |

## 下载

### bookget 支持情况

bookget 已支持此网站。相关源码：
- https://github.com/deweizhu/bookget/blob/main/app/utokyo.go

bookget 的下载逻辑：
1. 从 URL 中提取 `nu` 参数（正则 `nu=([A-Za-z0-9]+)`）
2. 请求作品详情页 HTML
3. 用正则 `<a href="pdf/([^"]+)"` 提取所有 PDF 文件名
4. 构造完整 PDF URL：`http://{host}/pdf/{filename}`
5. 使用自定义 HTTP 客户端下载，需设置：
   - `User-Agent`：自定义
   - `Referer`：原始页面 URL（需 URL 编码）
   - Cookie：通过 cookie jar 管理

### 手动下载方式

**PDF 下载**（推荐）：
1. 打开作品详情页
2. 从 HTML 中提取所有 `<a href="pdf/...">` 链接
3. 拼接完整 URL：`https://shanben.ioc.u-tokyo.ac.jp/pdf/{filename}`
4. 需设置 Referer 请求头为详情页 URL

**图片下载**：
- 在线阅读器中的图片可通过 `im` 和 `pg` 参数访问
- 图片为黑白扫描，PDF 品质更佳，推荐下载 PDF

### 保护措施

- 无水印（黑白扫描原始影像）
- 无登录要求
- 需设置正确的 Referer 请求头
- 版权声明禁止未经许可的复制和再发布

### IIIF

善本影像数据库（shanben.ioc.u-tokyo.ac.jp）**不支持 IIIF**。

研究所另有一个基于 Omeka S 的 IIIF 平台（iiif.ioc.u-tokyo.ac.jp），目前仅收录鹽谷温博士元曲选相关资料，内容与善本数据库不同：
- IIIF 平台入口：https://iiif.ioc.u-tokyo.ac.jp/s/kanseki/page/shionoya
- 该平台有约 306 件 IIIF 资源，分三个集合

### 注意事项

- PDF 文件较大（单卷 5-40 MB），批量下载注意控制并发
- 网站较老旧（2005 年上线），部分链接使用 HTTP 而非 HTTPS
- `shanben.ioc.u-tokyo.ac.jp` 和 `kanseki.ioc.u-tokyo.ac.jp` 是两个关联子系统，书目详情会重定向
