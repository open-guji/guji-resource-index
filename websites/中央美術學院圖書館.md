# 中央美術學院圖書館

中央美术学院（CAFA）图书馆建设的数字图书馆平台，收录了馆藏古籍、民国时期美术文献、金石碑帖拓片、藏书票等特色资源，以美术史和书画艺术类文献为主。

- 网站链接：http://dlib.cafa.edu.cn/ （校外访问：https://dlibgate.cafa.edu.cn/）
- 分享协议：仅供在线阅览，未明确标注开放协议
- 馆藏数字图书约 99 部，民国美术文献约 1,369 件，金石碑帖图像约 64 件
- 资源类型：古籍善本、民国美术文献、金石碑帖拓片、藏书票
- 支持 IIIF 协议，可使用 [bookget](https://github.com/deweizhu/bookget) 等工具下载
- 图片带有水印

## 搜索与浏览

平台提供多个子库入口，各子库可独立浏览和搜索：

- 馆藏数字图书：http://dlib.cafa.edu.cn/ebook/
- 民国美术文献库：http://dlib.cafa.edu.cn/mgmswx/
- 金石碑帖图像库：http://dlib.cafa.edu.cn/rubbing/
- 藏书票：http://dlib.cafa.edu.cn/bookplate/

搜索方式：
- 在各子库页面顶部输入关键词搜索
- 搜索结果可按出版社（Publisher）等字段筛选
- 可按出版日期排序
- 无需注册登录即可浏览（校外访问需通过 dlibgate.cafa.edu.cn 网关）

## 每本书能看到什么

| 字段 | 说明 | 示例 |
|------|------|------|
| 题名 | 书名（繁体） | 詒晋齋法書 |
| 册数 | 分册信息 | 8册 |
| 出版信息 | 出版社/刊刻信息 | 荣宝斋出版社 |
| 出版年代 | 出版或刊刻年代 | 待确认 |

- 每本书提供基于 IIIF 的高清图像查看器，支持在线逐页翻阅
- 图片支持缩放，长边可达约 5000 像素
- 图片带有水印
- 无 PDF 下载功能
- 无全文文字（OCR）

## 示例

- 馆藏数字图书：http://dlib.cafa.edu.cn/ebook/item/7294-n-a?offset=1
- 民国美术文献：http://dlib.cafa.edu.cn/mgmswx/item/5925-n-a?offset=9
- 金石碑帖：http://dlib.cafa.edu.cn/rubbing/
- 校外访问示例：https://dlibgate.cafa.edu.cn/ebook/item/7565--?offset=1

---

# 开发者文档

## URL 结构

### 详情页/阅读页
```
http://dlib.cafa.edu.cn/ebook/item/{book_id}?offset={page}
https://dlibgate.cafa.edu.cn/ebook/item/{book_id}?offset={page}
```
- `book_id`：资源标识符，格式如 `7294-n-a`（含书名缩写）或 `5649--2`（含册数）或 `7565--`
- `offset`：当前页码偏移量，从 1 开始

### 民国美术文献
```
http://dlib.cafa.edu.cn/mgmswx/item/{item_id}?offset={page}
```
- 与 ebook 结构类似，路径前缀不同

### 搜索/列表页
```
http://dlib.cafa.edu.cn/ebook/default?search={keyword}&sort=-PublishDate,_score&perpage={count}&page={page_num}
```
- `search`：搜索关键词
- `sort`：排序方式，如 `-PublishDate,_score`（按出版日期降序）或 `ReleaseDate,_score`
- `perpage`：每页数量
- `page`：页码

### 按出版社筛选
```
http://dlib.cafa.edu.cn/ebook/?refine[Publisher][]={publisher_name}
```

## 搜索 API

无公开 JSON API，搜索通过服务端渲染页面实现。搜索参数通过 URL query string 传递。

## 元数据获取

详情页为服务端渲染页面，元数据可通过 HTML 解析获取。具体 HTML 结构待确认（网站目前从外网访问不稳定）。

### 字段映射

| 中文字段 | 提取方式 |
|---------|---------|
| 题名 | 待确认（HTML 解析） |
| 册数 | URL 中 book_id 末尾数字（如 `5649--2` 表示 2 册） |
| 出版社 | 待确认（HTML 解析） |

## 下载

### IIIF 下载

网站使用 IIIF 协议提供图片服务，使用自建的 IIIF 图像服务器（LimbGallery）。

IIIF 图片信息获取流程：
1. 访问详情页 HTML，提取 IIIF 媒体 ID
   - 正则匹配：`IIIF=/([A-z0-9/_-]+)/iiif/`
   - 从页面 HTML 中获取 `iiifId`

2. 构造 IIIF 接口 URL：
   ```
   https://dlibgate.cafa.edu.cn/api/viewer/lgiiif?url=/srv/www/limbgallery/medias/{iiifId}/&max=10000
   ```

3. 接口返回 JSON，结构如下：
   ```json
   {
     "_links": { "self": { "href": "..." } },
     "_meta": { "took": 0.123 },
     "item": {
       "tiles": {
         "key1": {
           "@context": "...",
           "@id": "/i/?IIIF=/path/to/image.tif",
           "height": 1234,
           "width": 5678,
           "profile": "...",
           "protocol": "...",
           "tiles": { "scaleFactors": [1,2,4,8], "width": 256 }
         }
       }
     }
   }
   ```

4. 从 `item.tiles` 中提取各页图片的 `@id` 路径

5. 构造图片下载 URL：
   - 普通下载：`https://dlibgate.cafa.edu.cn{@id}/{format}` （format 如 `full/full/0/default.jpg`）
   - DZI 模式：`https://dlibgate.cafa.edu.cn{@id}/info.json`（获取 IIIF Image info.json 后用 dezoomify-rs 拼接）

### bookget 支持

bookget 已支持此平台。相关源码：
- https://github.com/deweizhu/bookget/blob/main/app/cafaedu.go

使用方式：
```bash
bookget "https://dlibgate.cafa.edu.cn/ebook/item/7565--?offset=1"
```

DZI 高清模式（使用 dezoomify-rs 拼接瓦片获取最大分辨率）：
```bash
bookget -dzi "https://dlibgate.cafa.edu.cn/ebook/item/7565--?offset=1"
```

### 注意事项

- **域名**：校内使用 `dlib.cafa.edu.cn`，校外使用 `dlibgate.cafa.edu.cn`
- **Referer**：请求需携带 Referer 头，值为当前页面 URL（经 URL 编码）
- **Cookie**：支持通过 cookie 文件传递认证信息
- **水印**：图片带有水印，无法通过参数去除
- **图片格式**：默认 JPEG，通过 IIIF Image API 参数控制
- **并发下载**：bookget 支持多线程并发下载
- **网络稳定性**：校外访问可能不稳定，dlib.cafa.edu.cn 有时无法从外网直接访问
