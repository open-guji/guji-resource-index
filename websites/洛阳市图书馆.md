# 洛阳市图书馆

洛阳市图书馆（河南省首批及全国第四批古籍重点保护单位）自建的馆藏珍贵古籍全文数据库，提供古籍 PDF 在线阅读。

- 网站链接：http://111.7.82.29:8090/index.php
- 官网主站：http://www.lyslib.cn/
- 分享协议：未明确标注
- 约 60 部 484 册古籍（首期数字化成果）
- 馆藏古籍总量：53,006 册，善本 262 种 4,026 册
- 资源类型：善本、明清古籍、地方文献
- 不支持 IIIF 协议
- 支持 [bookget](https://github.com/deweizhu/bookget) 下载

## 搜索与浏览

- 入口页面：http://111.7.82.29:8090/index.php
- 按分类浏览，点击进入具体古籍详情页
- 无需注册登录

## 每本书能看到什么

| 字段 | 说明 |
|------|------|
| 题名 | 书名 |
| PDF 阅读 | 内嵌 PDF 查看器在线阅读 |

- 提供 PDF 格式在线阅读（viewer.php）
- 无 OCR 全文文字

## 示例

- 详情页：`http://111.7.82.29:8090/productshow.php?cid=4&id=112`

## 当前状态

古籍数字资源服务器（111.7.82.29:8090）目前处于无法访问状态（ECONNREFUSED），可能临时下线或已迁移。官网 lyslib.cn 也无法正常访问。

---

# 开发者文档

## URL 结构

### 详情页
```
http://111.7.82.29:8090/productshow.php?cid={category_id}&id={book_id}
```
- `cid`：分类 ID
- `id`：古籍编号（纯数字）

### PDF 阅读页
```
http://111.7.82.29:8090/viewer.php?pdf={pdf_name}.pdf
```

### PDF 文件直链
```
http://111.7.82.29:8090/{pdf_name}.pdf
```

## 搜索 API

无公开搜索 API，需通过页面浏览。

## 元数据获取

详情页为传统服务端渲染 HTML。页面中包含 `viewer.php?pdf=xxx.pdf` 格式的链接，指向各册 PDF。

### 卷册链接提取

正则：
```
href=["']viewer.php\?pdf=(.+?)\.pdf&
```
匹配结果即为各册 PDF 的文件名。

## 下载

### bookget 支持

- 源码：[app/luoyang.go](https://github.com/deweizhu/bookget/blob/main/app/luoyang.go)
- 下载格式：PDF（整册 PDF 文件，非逐页图片）
- 下载流程：
  1. 从详情页 URL 提取 `id` 参数（正则 `&id=(\d+)`）
  2. GET 详情页 HTML，解析出所有 `viewer.php?pdf=xxx.pdf` 链接
  3. 拼接完整 PDF URL：`{host}/{pdf_name}.pdf`
  4. 使用 `gohttp.FastGet` 并发下载各册 PDF
  5. 输出文件命名：`{序号}.{原始文件名}`（如 `0001.xxx.pdf`）

### 必需 HTTP 请求头

| Header | 值 |
|--------|-----|
| User-Agent | 配置项 |
| Referer | 源页面 URL（经 URL 编码） |

### 保护措施

- Referer 校验：需设置 Referer 头
- 支持 Cookie 持久化（CookieJar / CookieFile）
