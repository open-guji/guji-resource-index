# 龍谷大學圖書館 - 貴重資料画像データベース「龍谷蔵」

龙谷大学图书馆建设的贵重资料画像数据库"龍谷蔵"（Ryukoku-zo），收录了龙谷大学所藏的古典籍等贵重资料的全页图像数据，涵盖文学、真宗、佛教、医学、理学、艺术、哲学、历史、社会科学等领域。

- 网站链接：https://da.library.ryukoku.ac.jp/
- 分享协议：待确认（具体使用条款需查阅网站公告）
- 6,369 种、15,211 册，约 746,909 张图像（持续更新中）
- 资源类型：佛教典籍、真宗文献、古典文学、医学古籍、科学文献、艺术文献、历史文书等
- 支持 IIIF 协议，可使用 [bookget](https://github.com/deweizhu/bookget) 等工具下载
- 支持三种 IIIF 查看器：Universal Viewer、Mirador、Lime
- 仅日文界面
- 已与 Japan Search（ジャパンサーチ）联动

## 搜索与浏览

- 搜索页面：https://da.library.ryukoku.ac.jp/
- 支持按资料名、著者名、请求记号等书志信息关键词搜索
- 可按以下分类浏览：
  - 文学（914 种）
  - 真宗（1,737 种）
  - 佛教（1,889 种）
  - 医学（225 种）
  - 理学（61 种）
  - 艺术/艺能（446 种）
  - 哲学/宗教（245 种）
  - 历史（362 种）
  - 社会科学（483 种）
- 另有专题文库可单独浏览：写字台文库、德水文库、长尾文库等
- 无需注册登录

## 每本书能看到什么

| 字段 | 说明 | 示例 |
|------|------|------|
| 请求记号 | 架位号 | 323.5-54-W-20 |
| 資料名 | 书名（罗马字/日文） | Shunjū saden chūso（春秋左伝注疏） |
| 別名 | 别名 | 左伝注疏 |
| 著者 | 作者/注者 | (晋)杜預 注 / (唐)孔穎達 疏 / 陸德明 |
| 出版者 | 出版机构 | 村上勘兵衛等 |
| 員数 | 卷册数 | 20册 |
| コレクション | 所属文库 | 写字台文库 |
| 画像数 | 图像总数 | 2,111 张 |

- 每件资源提供 IIIF 高清图像查看器（Universal Viewer / Mirador / Lime 可选）
- 支持在线翻阅全部页面
- 各册可单独查看（卷/册分别列出）
- 可链接至龙谷大学 OPAC 查看书目记录
- 无 PDF 下载
- 无全文文字（OCR）

## 示例

- 详情页：https://da.library.ryukoku.ac.jp/page/220901
- 在线阅读（第1册）：https://da.library.ryukoku.ac.jp/view/220901/1
- IIIF Manifest：https://da.library.ryukoku.ac.jp/iiif/220901/1/manifest.json
- 写字台文库专题：https://da.library.ryukoku.ac.jp/collections/shajidai-bunko.html

---

# 开发者文档

## URL 结构

### 详情页
```
https://da.library.ryukoku.ac.jp/page/{item_id}
```
- `item_id`：资源标识符，如 `220901`（字母数字组合）

### 在线阅读页（单册）
```
https://da.library.ryukoku.ac.jp/view/{item_id}/{volume}
```
- `item_id`：同上
- `volume`：册序号，如 `1`、`2`

### 分类浏览页
```
https://da.library.ryukoku.ac.jp/list/p/{page_number}
```

### 专题文库页
```
https://da.library.ryukoku.ac.jp/collections/{collection_name}.html
```
- `collection_name`：如 `shajidai-bunko`

### IIIF Manifest
```
https://da.library.ryukoku.ac.jp/iiif/{item_id}/{volume}/manifest.json
```
- 例如：`https://da.library.ryukoku.ac.jp/iiif/220901/1/manifest.json`
- 每一册都有独立的 manifest

## 搜索 API

无公开的 JSON 搜索 API。搜索功能通过页面表单提交，结果在 HTML 中渲染。

网站已与 Japan Search 联动，亦可通过 Japan Search API 间接搜索龙谷大学馆藏。

## 元数据获取

### 通过 HTML 解析

详情页 (`/page/{item_id}`) 为服务端渲染，元数据以表格形式呈现。可通过 HTML 解析提取各字段。

页面还包含各册的链接列表（`/view/{item_id}/{volume}` 格式），从中可获取册数信息。

### 通过 IIIF Manifest

每册的 manifest 包含标准 IIIF 格式的元数据和图像信息。

### 字段映射

| 中文字段 | 提取方式 |
|---------|---------|
| 资料名 | HTML 详情页解析 / IIIF Manifest `label` |
| 著者 | HTML 详情页解析 |
| 请求记号 | HTML 详情页解析 |
| 图片列表 | IIIF Manifest `sequences[0].canvases[*].images[0].resource` |
| 图片服务 | IIIF Manifest `sequences[0].canvases[*].images[0].resource.service.@id` |
| OPAC链接 | HTML 详情页中的 OPAC 外部链接 |

## 下载

### IIIF 下载（推荐）

龙谷大学贵重资料数据库完整支持 IIIF。

**从 Manifest 到图片 URL：**

1. 获取 manifest：`https://da.library.ryukoku.ac.jp/iiif/{item_id}/{volume}/manifest.json`
2. 解析 `sequences[0].canvases[]`
3. 提取每个 canvas 的 `images[0].resource.service.@id`（service ID）
4. 拼接 IIIF Image API 参数：
   - 原始尺寸：`{service_id}/full/full/0/default.jpg`
   - 指定宽度：`{service_id}/full/{width},/0/default.jpg`
   - info.json：`{service_id}/info.json`（用于 dezoomify 模式）

**注意事项：**
- 每一册有独立的 manifest，需先从详情页获取册数信息
- 支持 Dezoomify 模式获取更高分辨率

### bookget 支持

bookget 已内置龙谷大学支持。

- 源码：https://github.com/deweizhu/bookget/blob/main/app/ryukoku.go
- bookget wiki：https://github.com/deweizhu/bookget/wiki/04.%E5%8F%AF%E7%94%A8%E7%9A%84%E7%BD%91%E7%AB%99URL
- 用法示例：
  ```
  bookget "https://da.library.ryukoku.ac.jp/page/220901"
  ```

**bookget 关键逻辑（ryukoku.go）：**

1. 用正则 `/page/([A-Za-z0-9]+)` 从 URL 提取 `item_id`
2. 请求详情页 HTML，解析卷册链接（正则 `href="/view/([A-z0-9]+)/([A-z0-9]+)"`）
3. 对每册构造 IIIF manifest URL：`/iiif/{part1}/{part2}/manifest.json`
4. 解析 manifest JSON 中的 `sequences[0].canvases[]`
5. 提取每个 canvas 的 `images[0].resource.service.@id`
6. 支持两种下载模式：
   - 普通模式：`{service_id}/{format}`（如 `/full/full/0/default.jpg`）
   - Dezoomify 模式：`{service_id}/info.json` + dezoomify-rs 拼接
7. 使用 Cookie jar 管理会话
8. 文件名格式：`%04d.ext`

**必需的 HTTP 请求头：**

| Header | 值 |
|--------|---|
| `User-Agent` | 可配置 |
| `Referer` | 详情页 URL（需 URL encode） |
| `Origin` | 从 Referer 提取（dezoomify 模式） |

### 图片保护

- 无水印
- 使用 Cookie jar 管理会话状态
- 需设置 Referer 头
- IIIF Image API 支持标准操作
