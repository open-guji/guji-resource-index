# 维基共享资源 (Wikimedia Commons)

<!--
  本文件分两部分：
  - 分割线以上：用户文档，面向普通用户，语言简洁易懂，不含技术细节
  - 分割线以下：开发者文档，面向程序员，包含 API、HTML 解析、下载逻辑等技术细节
-->

维基共享资源（Wikimedia Commons）是维基媒体基金会运营的一个自由使用的媒体文件仓库（包含图片、声音、视频等）。它是维基百科等项目的多媒体资源库，但也独立收录了大量公共领域的古籍扫描件（通常为 DJVU 或 PDF 格式）和高清文物图像。

- 网站链接：https://commons.wikimedia.org/
- 分享协议：[公有领域 (Public Domain)](https://creativecommons.org/publicdomain/mark/1.0/deed.zh) 或 [CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/deed.zh) 等自由协议
- 约 1亿+ 个自由媒体文件
- 资源类型：古籍扫描件 (DjVu/PDF)、文物高清图、历史照片、手稿影像
- 支持 IIIF 协议（非官方/实验性支持），提供 MediaWiki API 访问

## 搜索与浏览

- 搜索页面：https://commons.wikimedia.org/w/index.php?search=
- 在搜索框输入关键词（如“Chinese classics”、“Oxyrhynchus papyri”等）。
- **按分类浏览**：古籍通常按分类组织，建议使用 Categories 进行浏览。
  - 例如：[Category:Chinese classics](https://commons.wikimedia.org/wiki/Category:Chinese_classics) (中国古籍), [Category:Rare books](https://commons.wikimedia.org/wiki/Category:Rare_books) (善本)。
- 搜索结果支持按文件类型（如仅显示 PDF/DjVu）和许可证进行筛选（通过高级搜索）。
- **无需注册登录**即可下载原图。

## 每本书/文件能看到什么

以古籍扫描件（File 页面）为例：

| 字段 | 说明 | 示例 |
|------|------|------|
| 说明 | 文件描述 | An abridged translation of Dream of the Red Chamber. |
| 日期 | 创建/发布日期 | 1929 |
| 来源 | 文件来源 | HathiTrust identifier |
| 作者 | 创作者 | Cao Xueqin / Wang Chi-chen |
| 授权 | 版权状况 | Public domain |
| 其他版本 | 链接到其他版本 | (如有) |

**特色功能**：
- **高清原图下载**：提供“Original file”链接，可下载未经压缩的原始扫描件（往往几百 MB）。
- **跨语言使用**：文件描述页面通常包含多种语言的机器可读数据（Structured Data on Commons）。
- **内置查看器**：对于 DjVu/PDF 文件，提供在线翻页阅读器。

## 示例

- 古籍扫描件 (DjVu)：[File:Dream of the Red Chamber (Wang, 1929).djvu](https://commons.wikimedia.org/wiki/File:Dream_of_the_Red_Chamber_(Wang,_1929).djvu)
- 图像 (Png)：[File:Dream of the red chamber - Youzheng version.png](https://commons.wikimedia.org/wiki/File:Dream_of_the_red_chamber_-_Youzheng_version.png)

---

# 开发者文档

## URL 结构

### 1. 文件页面 (File Page)
```
https://commons.wikimedia.org/wiki/File:{Filename}
```
- `{Filename}`: 文件名（包含扩展名），如 `Dream_of_the_Red_Chamber_(Wang,_1929).djvu`。
- **用途**：查看文件元数据、下载链接、版本历史。

### 2. 替代 URL (Alternate URL)
MediaWiki 也支持通过 `index.php` 访问，常用于包含特殊字符或分页参数的情况。
```
https://commons.wikimedia.org/w/index.php?title=File:{Filename}&page={PageNumber}
```
- `title`: 必须以 `File:` 开头。
- `page`: 指定查看多页文档（如 PDF, DjVu）的第几页。
- **示例**: `https://commons.wikimedia.org/w/index.php?title=File:Example.pdf&page=2`

### 3. 分类页面 (Category Page)
```
https://commons.wikimedia.org/wiki/Category:{CategoryName}
```
- `{CategoryName}`: 分类名称，如 `Chinese_classics`。
- **用途**：浏览相关主题的文件集合。

## 搜索 API

使用标准的 **MediaWiki API**。

### 1. 关键词搜索
- **URL**: `https://commons.wikimedia.org/w/api.php`
- **Method**: `GET`
- **Parameters**:
  - `action`: `query`
  - `list`: `search`
  - `srsearch`: `{Keyword} filetype:djvu` (支持 filetype 筛选)
  - `srnamespace`: `6` (File 名字空间)
  - `format`: `json`

**示例**: 搜索 "Chinese" 的 DjVu 文件
`api.php?action=query&list=search&srsearch=Chinese+filetype:djvu&srnamespace=6&format=json`

### 2. 获取分类成员
- **Parameters**:
  - `action`: `query`
  - `list`: `categorymembers`
  - `cmtitle`: `Category:Chinese_classics`
  - `cmtype`: `file|subcat`
  - `format`: `json`

## 元数据获取

### JSON API (API:Imageinfo)
这是获取元数据的标准方式，尤其是结构化数据 (`extmetadata`)。

**Request**:
```
https://commons.wikimedia.org/w/api.php?action=query&titles=File:Dream_of_the_Red_Chamber_(Wang,_1929).djvu&prop=imageinfo&iiprop=url|size|mime|extmetadata&format=json
```

**Response (JSON)**:
```json
{
    "query": {
        "pages": {
            "12345": {
                "title": "File:...",
                "imageinfo": [
                    {
                        "url": "https://upload.wikimedia.org/...",
                        "extmetadata": {
                            "DateTime": { "value": "1929", ... },
                            "ObjectName": { "value": "Dream of the Red Chamber", ... },
                            "Artist": { "value": "Cao Xueqin", ... },
                            "LicenseShortName": { "value": "Public domain", ... }
                        }
                    }
                ]
            }
        }
    }
}
```

**字段映射**:

| 中文字段 | JSON 路径 (query.pages.*.imageinfo[0].extmetadata) |
|---------|---------|
| 题名 | `ObjectName.value` |
| 著者 | `Artist.value` |
| 年代 | `DateTime.value` 或 `DateTimeOriginal.value` |
| 来源 | `Credit.value` 或 `Source.value` |
| 授权 | `LicenseShortName.value` |
| 描述 | `ImageDescription.value` |

## 下载

### 1. 直接下载 (推荐)
API 响应中的 `imageinfo[0].url` 即为原始文件的直链。
- **URL 格式**: `https://upload.wikimedia.org/wikipedia/commons/x/xy/{Filename}`
- **注意**: 需要设置 `User-Agent`，否则可能被拦截。

### 2. IIIF 支持 (实验性)
Wikimedia Toolforge 提供了一个 IIIF 代理服务，支持 IIIF Image API 和 Presentation API。
- **Endpoint**: `https://tools.wmflabs.org/zoomviewer/proxy.php`
- **Manifest URL**:
  ```
  https://tools.wmflabs.org/zoomviewer/proxy.php?iiif={Filename}/info.json
  ```
  (注意：URL 需要是对文件名进行 URI 编码)
- **Image API**:
  ```
  https://tools.wmflabs.org/zoomviewer/proxy.php?iiif={Filename}/{Region}/{Size}/{Rotation}/{Quality}.{Format}
  ```
- **限制**: 这是一个社区维护的工具，稳定性不如官方 API，且可能不支持所有文件格式。

### 3. 注意事项
- **User-Agent**: 必须包含联系方式，例如 `MyBot/1.0 (myname@mysite.com)`。
- **并发**: 遵守 [Api-Etiquette](https://www.mediawiki.org/wiki/API:Etiquette)，建议串行请求或低并发。
