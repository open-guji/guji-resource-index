# 抗日战争与近代中日关系文献数据平台

<!--
  本文件分两部分：
  - 分割线以上：用户文档，面向普通用户，语言简洁易懂，不含技术细节
  - 分割线以下：开发者文档，面向程序员，包含 API、HTML 解析、下载逻辑等技术细节
-->

中国社会科学院近代史研究所主办，百度公司提供技术支持的公益性近代文献数据平台。收藏晚清至1949年的报纸、期刊、图书、档案、图片、音视频等多种类型的近代史文献资源，总量超过1500万页。

- 网站链接：https://www.modernhistory.org.cn/
- 帮助中心：https://help.modernhistory.org.cn/
- 分享协议：公益开放，永久免费浏览；注册后免费下载（每月2000页）
- 资源规模：图书超13万册，报纸超1000种，期刊超10000种
- 资源类型：报纸、期刊、图书、档案、图片、音频、视频
- 不支持标准 IIIF 协议（使用自建 IIIF 图片服务器，但未暴露标准 Manifest 接口）
- 支持 [bookget](https://github.com/deweizhu/bookget) 下载

## 搜索与浏览

- 搜索页面：https://www.modernhistory.org.cn/#/search
- 在首页顶部搜索框输入关键词即可搜索，支持在书目信息和完整目录中检索
- 搜索结果可按以下维度筛选：
  - 文献类型（图书、报纸、期刊、档案、图片、音频、视频）
  - 时间范围
  - 分类主题
- 浏览方式：
  - 首页有"精品推荐"、"新上线"、"红色文献"等专题入口
  - 可按出版时间、学科主题进行浏览
  - 报纸可按年份、月份逐级浏览
  - 期刊保留原始出版顺序，可关联浏览同刊物其他期
- 注册登录：
  - 浏览不需要注册，免费在线阅览（150 DPI）
  - 注册免费账号后可下载 300 DPI 图片，每月限 2000 页

## 每本书能看到什么

| 字段 | 说明 | 示例 |
|------|------|------|
| 题名 | 文献名称 | 向导 |
| 文献类型 | 图书/报纸/期刊等 | 期刊 |
| 作者/编者 | 责任者信息 | 待确认 |
| 出版信息 | 出版地、出版者 | 待确认 |
| 年代 | 出版年份 | 1937 |
| 分类 | 主题分类 | 待确认 |
| 页数 | 文献总页数 | 待确认 |

补充说明：
- 可在线翻阅高清扫描图片，支持放大镜功能
- 注册用户可下载 300 DPI 图片（每月 2000 页限额）
- 支持"摘录"功能，可在阅读时记录笔记
- 暂无全文 OCR 文字版本（未来计划加入）
- 报纸类文献包含《申报》《大公报》《益世报》《民国日报》《解放日报》等著名报刊

## 示例

- 期刊详情页：https://www.modernhistory.org.cn/#/DocumentDetails_qk?fileCode=9999_qk_00005&title=%E5%90%91%E5%AF%BC

---

# 开发者文档

## 技术架构概述

该网站是一个 Vue.js 单页应用（SPA），页面内容通过 JavaScript 动态加载，`WebFetch` 无法直接抓取页面内容。需要通过后端 API 获取数据。

- 前端：Vue.js SPA
- 后端 API 前缀：`/backend-prod/`
- 图片服务：自建 IIIF 图片服务器 `https://iiif.modernhistory.org.cn/iiif/2`
- 统计：百度统计

## URL 结构

网站使用 hash 路由（`#/`），不同文献类型有不同的 URL 模式。

### 文献详情页

URL 中的 `fileCode` 参数标识文献，格式根据文献类型不同而变化：

```
# 期刊（qk）
https://www.modernhistory.org.cn/#/DocumentDetails_qk?fileCode={fileCode}&title={title}

# 图书（ts）
https://www.modernhistory.org.cn/#/DocumentDetails_ts?fileCode={fileCode}&title={title}

# 报纸（bz）
https://www.modernhistory.org.cn/#/DocumentDetails_bz?fileCode={fileCode}&title={title}
```

- `fileCode`：文献唯一标识符，格式如 `9999_qk_00005`（`qk`=期刊, `ts`=图书, `bz`=报纸）
- `title`：URL 编码的文献标题（用于显示，非必需参数）

从 URL 中提取 `fileCode` 的正则：`fileCode=([A-Za-z0-9_-]+)`

## 搜索 API

待确认。网站为 SPA，搜索通过后端 API 实现，具体搜索接口尚未逆向分析。推测在 `/backend-prod/` 路径下有对应的搜索端点。

## 元数据获取

### 详情信息 API

```
GET /backend-prod/esBook/findDetailsInfo/{fileCode}
```

- `fileCode`：从 URL 提取的文献标识符
- 返回：JSON 格式的文献元数据

### 报纸年份查询

```
GET /backend-prod/esBook/findYear/{fileCode}
```

返回指定报纸可用的年份列表。

### 报纸月份查询

```
GET /backend-prod/esBook/findMonth
```

（具体参数待确认，可能通过 query string 传递年份）

### 报纸按月获取目录

```
GET /backend-prod/esBook/findDirectoryByMonth
```

### 图书/期刊按年获取目录

```
GET /backend-prod/esBook/findDirectoryByYear/{fileCode}
```

### 字段映射

| 中文字段 | 提取方式 |
|---------|---------|
| 题名 | JSON 响应中的字段（待确认具体路径） |
| 文献类型 | 从 fileCode 中的类型标识推断：`qk`=期刊, `ts`=图书, `bz`=报纸 |
| 其他字段 | 待确认，需抓包分析 `/backend-prod/esBook/findDetailsInfo/` 响应 |

## 下载

### IIIF 图片服务器

平台使用自建 IIIF Image API 2.0 服务器：

```
https://iiif.modernhistory.org.cn/iiif/2/{image_id}/{region}/{size}/{rotation}/{quality}.{format}
```

但平台并未暴露标准的 IIIF Presentation API Manifest 端点，图片 ID 需要通过后端 API 间接获取。

### bookget 支持

bookget 通过 `war1931.go` 模块支持该平台：

- 源码位置：https://github.com/deweizhu/bookget/blob/main/app/war1931.go
- 支持的文献类型：图书（ts）、报纸（bz）、期刊（qk）

下载流程（以 bookget 源码分析）：

1. 从用户提供的 URL 中提取 `fileCode`
2. 根据文献类型调用不同的卷册获取逻辑：
   - **图书/期刊**：调用 `/backend-prod/esBook/findDirectoryByYear/{fileCode}` 获取目录
   - **报纸**：先调用 `findYear` 获取年份列表，再调用 `findMonth` 获取月份，最后调用 `findDirectoryByMonth` 获取具体页面列表
3. 从目录 API 响应中获取各页面的 canvas/图片信息
4. 通过 IIIF Image API 下载各页图片

### HTTP 请求要求

- 需要设置标准浏览器 User-Agent
- 需要设置 Accept-Language 头
- 需要设置 Accept 头
- 使用 Cookie Jar 保持会话

### 图片保护措施

- 未登录用户只能浏览 150 DPI 图片
- 注册登录后可获取 300 DPI 图片
- 每月下载限额 2000 页（通过账户控制）
- 具体是否有水印、Referer 校验等保护措施：待确认
