# 駒澤大學電子貴重書庫

<!--
  本文件分两部分：
  - 分割线以上：用户文档，面向普通用户，语言简洁易懂，不含技术细节
  - 分割线以下：开发者文档，面向程序员，包含 API、HTML 解析、下载逻辑等技术细节
-->

驹泽大学电子贵重书库是日本驹泽大学图书馆建设的数字化平台，公开该校所藏贵重资料的高清图像。驹泽大学是日本著名的佛教（曹洞宗）大学，拥有日本规模最大的禅宗及佛教文献收藏之一，馆藏总量约124万册。电子贵重书库收录贵重图书、禅籍善本、个人文库、古典籍及明版大藏经等约8,800余件数字化资料。

- 网站链接：https://wwwopac.komazawa-u.ac.jp/repo/repository/collections/
- 分享协议：未明确标注开放授权（建议使用前确认版权条款）
- 约 8,812 件数字化资料
- 资源类型：禅籍善本、佛教典籍、明版大藏经、和古书、漢籍、个人文库（佛教学者藏书）
- 支持 IIIF 协议，可使用 [bookget](https://github.com/deweizhu/bookget) 等工具下载

## 搜索与浏览

- 搜索页面：https://wwwopac.komazawa-u.ac.jp/repo/repository/collections/
- 支持简单搜索和高级搜索，可按题名、著者、出版者、主题、语言等字段检索
- 可按以下五大馆藏分类浏览：
  - **贵重图书**（4,206件）：指定贵重资料，含原始图像、日英双语书志信息，部分附翻刻文
  - **禅籍善本图录**（896件）：禅宗及佛教研究善本图像与解题
  - **个人文库**（1,016件）：七个捐赠文库，含沼泽文库（400件）、永久文库（229件）、泽木文库等
  - **古典籍**（730件）：贵重图书以外的和古书、漢籍等
  - **明版大藏经**（1,964件）：正藏908件、续藏651件、又续藏401件
- 无需注册登录即可浏览和阅读

## 每本书能看到什么

| 字段 | 说明 | 示例 |
|------|------|------|
| 题名 | 书名 | 憨休禅師語録 |
| 著者 | 作者 | 憨休 |
| 出版者 | 刊行者 | - |
| 出版年 | 刊行年代 | - |
| 主题 | 分类主题 | 禅宗語録 |
| 语言 | 使用语言 | jpn |
| 物理形态 | 册数/页数 | 1冊 |

- 可在线翻阅高清图片
- 部分资料附有翻刻文（文字转录）
- 贵重图书附日英双语书志信息

## 示例

- 馆藏分类浏览：https://wwwopac.komazawa-u.ac.jp/repo/repository/collections/
- 贵重图书分类：进入首页后点击「貴重図書」分类浏览

---

# 开发者文档

## URL 结构

### 馆藏浏览页
```
https://wwwopac.komazawa-u.ac.jp/repo/repository/collections/
```
浏览各分类使用 `/search/{code}/` 格式：
- 贵重图书：`/search/701/`
- 禅籍善本图录：`/search/710/`
- 个人文库：`/search/740010/`（沼泽文库等各有子代码）
- 古典籍：`/search/750/`
- 明版大藏经：`/search/760/`

### IIIF Manifest
```
https://wwwopac.komazawa-u.ac.jp/mmd/manifest/1/{collection_code}/{item_id}.json
```
- `collection_code`：馆藏代码，如 `700`
- `item_id`：资料编号，如 `37751`
- 示例：`https://wwwopac.komazawa-u.ac.jp/mmd/manifest/1/700/37751.json`

### 图片服务
```
https://wwwopac.komazawa-u.ac.jp/mmd/iiif/1/{collection_code}/{item_id}/{image_id}.tiff/{region}/{size}/{rotation}/{quality}.{format}
```
- IIIF Image API：ImageService3, Level 2
- 示例：`https://wwwopac.komazawa-u.ac.jp/mmd/iiif/1/700/37751/29284.tiff/full/max/0/default.jpg`

## 搜索 API

无公开 REST API。搜索通过网页 OPAC 表单提交，支持简单搜索和高级搜索（多字段组合检索）。

## 元数据获取

可从 IIIF Manifest JSON 中提取基本元数据。Manifest 遵循 IIIF Presentation API 3.0 规范。

### 字段映射（从 IIIF Manifest）

| 中文字段 | 提取方式 |
|---------|---------|
| 题名 | `manifest.label`（多语言对象） |
| 阅读方向 | `manifest.viewingDirection`（`right-to-left`） |
| 页数 | `manifest.items.length`（canvas 数量） |
| 画幅 | 各 canvas 的 `width` / `height`（典型 3307 x 4311） |

注意：与 Keio 和关西大学不同，Komazawa 的 Manifest 中元数据字段较少，主要包含题名和结构信息。更详细的书志元数据需从 OPAC 页面提取。

## 下载

### IIIF 方式（推荐）

1. 获取 Manifest URL：`https://wwwopac.komazawa-u.ac.jp/mmd/manifest/1/{collection_code}/{item_id}.json`
2. 解析 manifest 中的 `items`（IIIF v3 使用 `items` 而非 `sequences`）
3. 每个 canvas（item）的 `items[0].items[0].body.service[0].id` 为图片服务地址
4. 拼接 IIIF Image API 参数获取图片
   - 全尺寸：`/full/max/0/default.jpg`

IIIF Presentation API 版本：3.0
IIIF Image API 版本：ImageService3, Level 2
阅读方向：right-to-left
典型画幅：3307 x 4311 像素

### bookget 支持

bookget 的 IIIF wiki 页面列出了驹泽大学：
- Manifest 示例：`https://wwwopac.komazawa-u.ac.jp/mmd/manifest/1/700/37751.json`
- 可使用 bookget 通用 IIIF 模块下载
- 源码参考：https://github.com/deweizhu/bookget/blob/main/app/iiif.go
- 注意：Komazawa 使用 IIIF v3，bookget 的通用 IIIF 模块已支持 v2/v3 自动检测

### 注意事项

- 未明确标注开放授权，下载前请确认使用条款
- 图片分辨率较高（3307 x 4311），单张图片体积较大
- 无需特殊 HTTP 请求头
- 无明显水印或防护措施
