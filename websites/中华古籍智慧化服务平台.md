# 中华古籍智慧化服务平台

由国家图书馆牵头、联动全国古籍收藏单位共同建设的古籍智慧服务平台，整合 AI 能力（自动标点、文白翻译、OCR、知识图谱），是国家图书馆古籍数字资源的新一代平台。

- 网站链接：https://guji.nlc.cn/
- 分享协议：公共资源（免费开放）
- 约 1 万余种、10 万余册古籍
- 资源类型：汉文古籍、少数民族文字古籍等
- 不支持 IIIF 协议，可使用 [bookget](https://github.com/deweizhu/bookget) 下载

## 搜索与浏览

在首页搜索框输入关键词即可搜索，支持按古籍、卷目、全文、知识四种维度检索：

- 搜索页面：https://guji.nlc.cn/
- 支持高级搜索（按题名、著者、版本等字段组合检索）
- 提供书目导航，可按四部分类浏览
- 无需注册登录即可搜索和阅览

## 每本书能看到什么

| 字段 | 说明 | 示例 |
|------|------|------|
| 题名 | 书名（含卷数） | 周易：九卷，略例：一卷 |
| 著者 | 作者及责任方式 | 王弼 注、韓康伯 注、陸德明 釋文 |
| 朝代 | 著者所属朝代 | 三國魏、晉、唐 |
| 版本类型 | 刻本/抄本等 | 刻本 |
| 出版年代 | 中国纪年+公元 | 宋（960-1279） |
| 行款版式 | 行字数、版口等 | 12行21～22字，小字雙行28字，白口，左右雙邊。 |
| 装帧形式 | 装帧方式 | 綫裝 |
| 数量 | 册数 | 3冊 |
| 开本尺寸 | 书叶尺寸 | 15.9×24.3cm |
| 收藏单位 | 馆藏机构 | 國家圖書館 |
| 索书号 | 馆藏编号 | 03337 |
| 四部分类 | 四部分类法 | 經部　易類　傳說之屬 |
| 文献类型 | 文献种类 | 漢文古籍 |
| 语种 | 文字语种 | 漢語 |
| 批校题跋 | 名家批校记录 | 文嘉 題款、董其昌 題款 |
| 国家珍贵古籍名录号 | 名录编号 | 00191 |

每本书可在线翻阅图片，支持 AI 自动标点、文白翻译、字典查询等智能功能。部分资源有全文文字（OCR）。

## 示例

- 详情页：https://guji.nlc.cn/guji/pjkf/detail?metadataId=0021001379780000
- 资源详情（另一种入口）：https://guji.nlc.cn/resource/resourceDetail?id=1001254

---

# 开发者文档

## URL 结构

### 详情页（pjkf/detail）
```
https://guji.nlc.cn/guji/pjkf/detail?metadataId={metadataId}
```
- `metadataId`：元数据 ID，如 `0021001379780000` 或纯数字 `1011141`

### 资源详情页（resourceDetail）
```
https://guji.nlc.cn/resource/resourceDetail?id={id}
```
- `id`：资源 ID，数字格式

### metadataId 提取正则
```regex
(?i)metadataId=([A-Za-z0-9_-]+)    # 优先匹配
(?i)\?id=([A-Za-z0-9_-]+)          # 备用匹配
```

## 搜索 API

```
POST https://guji.nlc.cn/api/resource/list
```

**请求体：**
```json
{
  "type": "1",
  "typeList": ["1", "2", "3", "4"],
  "sort": "orderSeq",
  "page": 1,
  "rows": 10,
  "keyword": "周易",
  "advancedRetrievalParams": []
}
```

`type` 值：`"1"` = 古籍，`"2"` = 卷目，`"3"` = 全文，`"4"` = 知识

高级搜索支持字段过滤：
```json
{
  "advancedRetrievalParams": [
    {"relation": "must", "field": "parallelTitle_title", "keyword": "周易", "match": "term"}
  ]
}
```

## 元数据获取

### 技术架构

- **前端框架：** SPA 单页应用（Vue.js），使用 Vite 构建
- 页面首次加载时显示加载动画，然后动态加载内容
- **无法通过 HTTP GET 获取 HTML 中的元信息**，必须通过后端 API 获取

### HTTP 请求头

**所有 API 请求必须设置以下请求头**，否则返回 `{"msg":"访问被拒绝！","code":105}`：
```
Content-Type: application/json
Referer: https://guji.nlc.cn/
Origin: https://guji.nlc.cn
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 ...
```

### 完整元数据 API（核心接口）

```
POST https://guji.nlc.cn/api/anc/ancMetadataDetail/{metadataId}
```
注意：metadataId 是**路径参数**，不是查询参数。

**响应示例（周易，metadataId=1011141）：**
```json
{
  "msg": "成功",
  "code": 200,
  "data": {
    "id": 1011141,
    "directoryNumber": "00191",
    "censusNumber": "",
    "edition": "刻本",
    "language": "漢語",
    "type": "漢文古籍",
    "quantity": "3",

    "parallelTitle": [{
      "title": "周易：九卷，略例：一卷",
      "creators": [
        {"creator": "王弼", "role": "注", "statementOfResponsiblePerson": "三國魏"},
        {"creator": "韓康伯", "role": "注", "statementOfResponsiblePerson": "晉"},
        {"creator": "陸德明", "role": "釋文", "statementOfResponsiblePerson": "唐"}
      ],
      "contributors": [{"contributor": "", "role": "", "statementOfResponsiblePerson": ""}]
    }],

    "publisher": {
      "publishing": [{
        "publisher": "",
        "placeOfPublication": "",
        "publishingMethod": "",
        "issuedGregorian": {
          "issuedChineseCalendar": "宋",
          "issuedGregorianCalendar": "960-1279"
        }
      }]
    },

    "physicalDescription": [{
      "quantity": "3冊",
      "binding": "綫裝",
      "dimension": ["15.9×24.3cm"]
    }],

    "description": [{
      "paragraphFormat": ["12行21～22字，小字雙行28字，白口，左右雙邊。"],
      "frameSize": [],
      "editionDescription": "",
      "inventoryShortageVolume": ""
    }],

    "subject": [{"fdc": ["經部　易類　傳說之屬"]}],

    "location": [{
      "collectionUnit": "國家圖書館",
      "callNumber": ["03337"]
    }],

    "provenance": [{
      "inscriptionWriter": [
        {"inscriptionWriter": "文嘉", "writerStat": "明", "inscriptionRole": "題款"},
        {"inscriptionWriter": "董其昌", "writerStat": "明", "inscriptionRole": "題款"}
      ]
    }]
  }
}
```

### 简要元数据 API（轻量接口）

```
POST https://guji.nlc.cn/api/anc/ancMetadataTitleCreatorEdition/{metadataId}
```

**响应示例：**
```json
{
  "code": 200,
  "data": {
    "id": 1011077,
    "title": "四書章句集注：二十八卷",
    "creator": "[宋] 朱熹 撰",
    "edition": "刻本",
    "collectionUnit": "國家圖書館",
    "orgName": "国家图书馆",
    "fdc": "經部　四書類　類編之屬",
    "type": "漢文古籍",
    "coverPath": "...",
    "ftpId": "1"
  }
}
```

### 元数据字段 Schema

```
POST https://guji.nlc.cn/api/anc/ancMetadataDetailParamGroup
```
返回所有元数据字段的层级定义（fieldName、fieldLabel、childFields），可用于了解完整字段列表。

### 字段映射

| 中文字段 | JSON 路径 |
|---------|----------|
| 书名 | `parallelTitle[0].title` |
| 作者 | `parallelTitle[0].creators[].creator` |
| 朝代 | `parallelTitle[0].creators[].statementOfResponsiblePerson` |
| 责任方式 | `parallelTitle[0].creators[].role` |
| 版本类型 | `edition` |
| 出版者 | `publisher.publishing[0].publisher` |
| 出版年号 | `publisher.publishing[0].issuedGregorian.issuedChineseCalendar` |
| 公元纪年 | `publisher.publishing[0].issuedGregorian.issuedGregorianCalendar` |
| 行款版式 | `description[0].paragraphFormat[]` |
| 版框尺寸 | `description[0].frameSize[]` |
| 装帧形式 | `physicalDescription[0].binding` |
| 数量 | `physicalDescription[0].quantity` |
| 开本尺寸 | `physicalDescription[0].dimension[]` |
| 收藏单位 | `location[0].collectionUnit` |
| 索书号 | `location[0].callNumber[]` |
| 四部分类 | `subject[0].fdc[]` |
| 文献类型 | `type` |
| 语种 | `language` |
| 批校题跋 | `provenance[0].inscriptionWriter[]` |
| 国家珍贵古籍名录号 | `directoryNumber` |
| 古籍普查登记号 | `censusNumber` |
| 残存附注 | `description[0].inventoryShortageVolume` |

## 下载

### 目录与图片 API

#### 目录结构
```
POST https://guji.nlc.cn/api/anc/ancStructureAndCatalogList?metadataId={metadataId}
```

返回卷/册的树形结构，每个节点包含：
- `volumeTitle`：册标题（如"第一冊（大學）"）
- `structureId`：分卷 ID
- `fileNumber`：图片数量
- `imageIdList`：图片 ID 列表
- `children[]`：子目录（含 `volumeTitleAndArticleTitle`、`articleAuthor`、`type`、`page` 等）

#### 图片 ID 列表
```
POST https://guji.nlc.cn/api/anc/ancImageIdListWithPageNum?metadataId={metadataId}
```

响应：
```json
{
  "data": {
    "imageIdList": [
      {"orderSeq": "1", "imageId": "7109734", "structureId": 1124873, "pageNum": 1}
    ],
    "total": 757
  }
}
```

#### 单张图片路径
```
POST https://guji.nlc.cn/api/anc/ancImageAndContent?metadataId={metadataId}&structureId={structureId}&imageId={imageId}
```

返回 `data.filePath` 用于构建下载 URL。

### 图片下载流程

1. **获取图片列表：** POST `/api/anc/ancImageIdListWithPageNum?metadataId={id}` 获取所有图片 ID
2. **按卷分组：** 根据 `structureId` 将图片分组到对应卷册
3. **获取图片路径：** 对每张图片 POST `/api/anc/ancImageAndContent` 获取 `filePath`
4. **下载图片：** GET `/api/common/jpgViewer?ftpId=1&filePathName={编码后的filePath}` 下载图片
5. **去除安全头：** 下载的图片数据开头可能包含安全标记 `###SECURED_IMAGE###`（UTF-8 字节），需要检测并去除后才是有效的图片文件

### 其他 API 端点

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/anc/ancMetadataDetailUserCustomize` | POST | 自定义展示字段（文献主题、流经地区等） |
| `/api/resource/getMetadataFieldShowList` | GET | 搜索筛选项配置 |
| `/api/resource/getMetadataBibliographyNavigationList` | GET | 书目导航分类 |
| `/api/anc/ancResultTrans` | POST | AI 文白翻译 |
| `/api/anc/ancResultComma` | POST | AI 自动标点 |
| `/api/third/readDictionarySearch` | POST | 字典查询 |
| `/api/third/searchSemantic` | POST | AI 语义搜索 |
| `/api/resource/read/search` | GET | 书内全文搜索 |

### bookget 支持

bookget 支持此平台。相关源码：
- https://github.com/deweizhu/bookget/blob/main/app/nlcguji.go
- https://github.com/deweizhu/bookget/blob/main/model/nlc/nlc.go

不支持 IIIF 协议，使用平台自有的 REST API。
