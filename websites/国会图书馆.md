# 美国国会图书馆 - Chinese Rare Book Digital Collection

美国国会图书馆（Library of Congress）亚洲部的中文善本数字典藏，由国会图书馆与台湾国家图书馆合作数字化，是海外最重要的中文善本收藏之一。馆藏涵盖宋元明清各代珍本，部分为海内外孤本。

- 网站链接：https://www.loc.gov/collections/chinese-rare-books/
- 分享协议：国会图书馆与台湾国家图书馆合作授权，仅供教育和研究用途，不得用于第三方商业用途（[权利声明](https://www.loc.gov/collections/chinese-rare-books/about-this-collection/rights-and-access/)）
- 约 5,300 部中文善本馆藏，其中近 2,000 部已数字化上线
- 资源类型：善本刻本、手稿写本、佛经、彩绘插图本、地方志、古地图
- 支持 IIIF 协议（Image API 2.0），可使用 [bookget](https://github.com/deweizhu/bookget) 等工具下载

## 搜索与浏览

在专题页面顶部搜索框输入关键词即可搜索，支持中英文（罗马拼音）：
- 搜索页面：https://www.loc.gov/collections/chinese-rare-books/?q={关键词}

搜索结果可按以下维度筛选：
- 原始格式（书籍、手稿、地图等）
- 在线格式（图片、PDF）
- 年代范围（如 1000-1099、1500-1599、1800-1899）
- 地点（中国各省，如山东省、浙江省、敦煌等）
- 主题（如"shi bu"史部、"zi bu"子部、"di li lei"地理类等）
- 著者/贡献者
- 语种（中文、英文等）

无需注册登录即可浏览和查看全部资源。

## 每本书能看到什么

打开一本书的详情页，可以看到：

| 字段 | 说明 | 示例 |
|------|------|------|
| Title | 题名（罗马拼音） | Xin jue li fa bian lan xiang ji bei yao tong shu da quan |
| Other Title | 其他题名（含中文原题） | 新鐫曆法便覽象吉備要通書大全 |
| Contributor Names | 著者 | Wei, Jian, active 1712, hui shu |
| Created/Published | 出版信息 | [China] : Bu yue lou, [Qing Kangxi 51 nian, 1712] |
| Date | 年代 | 1712 |
| Language | 语种 | Chinese |
| Subject | 主题分类（拼音） | zi bu, tian wen suan fa lei |
| Subject Headings | 主题标目 | 国会图书馆标准主题词 |
| Medium | 形制 | 12 volumes : illustrations |
| Description | 物理描述 | 包含尺寸、装帧等信息 |
| Notes | 附注 | 题名来源、品相、递藏信息等 |
| LCCN | 国会图书馆控制号 | 2014514163 |

每本书提供在线阅读器浏览全部图片，支持翻页、缩放。多卷本按卷分组展示（如"Preface/Table of Contents""Juan 1""Juan 2"等）。

页面底部提供 IIIF Manifest（JSON-LD）链接，可复制用于 IIIF 兼容查看器。

## 示例

- 专题首页：https://www.loc.gov/collections/chinese-rare-books/
- 详情页（通书大全）：https://www.loc.gov/item/2014514163/
- 详情页（永乐大典）：https://www.loc.gov/item/2014436533/
- 搜索示例：https://www.loc.gov/collections/chinese-rare-books/?q=zhou+yi

---

# 开发者文档

## URL 结构

### 专题集合页
```
https://www.loc.gov/collections/chinese-rare-books/
```

### 详情页
```
https://www.loc.gov/item/{LCCN}/
```
- `LCCN`：国会图书馆控制号，如 `2014514163`

### 资源页（单卷/单册）
```
https://www.loc.gov/resource/lcnclscd.{LCCN}.{VOL_ID}/
```
- `VOL_ID`：卷标识，如 `1A001`

### IIIF Image API
```
https://tile.loc.gov/image-services/iiif/service:asian:lcnclscd:{LCCN}:{VOL}:{PAGE}/full/pct:100/0/default.jpg
```
- `VOL`：卷号标识（如 `1A000`、`1A001`）
- `PAGE`：页号标识（如 `00001a`、`01b02a`）
- 支持缩放：`pct:12.5`、`pct:25`、`pct:50`、`pct:100`

### IIIF info.json
```
https://tile.loc.gov/image-services/iiif/service:asian:lcnclscd:{LCCN}:{VOL}:{PAGE}/info.json
```

### 原始文件（JP2/TIFF）
```
https://tile.loc.gov/storage-services/service/asian/lcnclscd/{LCCN}/{VOL}/{PAGE}.jp2
https://tile.loc.gov/storage-services/master/asian/lcnclscd/{LCCN}/{VOL}/{PAGE}.tif
```

## 搜索 API

国会图书馆提供 JSON API，在任何页面 URL 后添加 `?fo=json` 即可获取 JSON 响应。

### 集合搜索
```
GET https://www.loc.gov/collections/chinese-rare-books/?q={关键词}&fo=json&c={每页数量}&sp={页码}
```

**参数：**

| 参数 | 说明 | 示例 |
|------|------|------|
| `q` | 关键词搜索 | `q=zhou+yi` |
| `fo` | 输出格式 | `fo=json` |
| `c` | 每页结果数（默认25） | `c=50` |
| `sp` | 页码（从1开始） | `sp=2` |
| `fa` | 过滤/筛选（facet） | `fa=language:chinese` |
| `sb` | 排序字段 | `sb=date`、`sb=title_s` |
| `at` | 选择返回属性 | `at=results` |

**筛选参数（fa）支持的维度：**

| 筛选维度 | 参数值 | 示例 |
|---------|--------|------|
| 语种 | `language:{value}` | `fa=language:chinese` |
| 地点 | `location:{value}` | `fa=location:china` |
| 主题 | `subject:{value}` | `fa=subject:shi bu` |
| 原始格式 | `original-format:{value}` | `fa=original-format:book` |
| 在线格式 | `online-format:{value}` | `fa=online-format:image` |
| 是否数字化 | `digitized:{value}` | `fa=digitized:true` |
| 著者 | `contributor:{value}` | `fa=contributor:zhu xi` |
| 所属集合 | `partof:{value}` | `fa=partof:chinese rare book digital collection` |

多个筛选条件用管道符 `|` 分隔：`fa=language:chinese|subject:shi bu`

**搜索响应结构：**
```json
{
  "results": [
    {
      "id": "http://www.loc.gov/item/2014514163/",
      "title": "Xin jue li fa bian lan...",
      "date": "1712",
      "description": ["..."],
      "url": "https://www.loc.gov/item/2014514163/",
      "image_url": ["..."],
      "subjects": ["..."],
      "contributors": ["..."],
      "language": ["chinese"],
      "digitized": true,
      "online_format": ["image"]
    }
  ],
  "pagination": { "current": 1, "total": 40 }
}
```

### 单条记录 API
```
GET https://www.loc.gov/item/{LCCN}/?fo=json
```

可用 `at` 参数选择返回部分数据：
- `?fo=json&at=item` — 仅返回元数据
- `?fo=json&at=resources` — 仅返回资源文件信息
- `?fo=json&at=cite_this` — 仅返回引用信息

## 元数据获取

LOC 提供完整的 JSON API，无需解析 HTML。

### 字段映射

| 中文字段 | JSON 路径 | 说明 |
|---------|-----------|------|
| 题名 | `item.title` | 罗马拼音题名 |
| 其他题名 | `item.other_title` | 含中文原题 |
| 著者 | `item.contributor_names` | 数组 |
| 出版信息 | `item.created_published` | 含出版地、出版者、年代 |
| 年代 | `item.date` | 如 "1712" |
| 语种 | `item.language` | 数组，如 ["chinese"] |
| 主题（拼音） | `item.subject` | 数组 |
| 主题标目 | `item.subject_headings` | 国会图书馆标准主题词 |
| 形制 | `item.medium` | 如 "12 volumes : illustrations" |
| 描述 | `item.description` | 物理描述 |
| 附注 | `item.notes` | 数组 |
| 格式 | `item.format` | 如 ["book"] |
| LCCN | `item.library_of_congress_control_number` | 控制号 |
| MIME类型 | `item.mime_type` | 如 ["image/tiff", "image/jpeg", "image/jp2"] |
| 是否数字化 | `item.digitized` | 布尔值 |
| 是否限制访问 | `item.access_restricted` | 布尔值（中文善本为 false） |
| 所属集合 | `item.partof` | 数组 |
| 权利声明 | `item.rights` | 使用条款文本 |

## 下载

### IIIF Image API 2.0

LOC 使用 IIIF Image API 2.0 提供图片服务。

**图片服务基础 URL：**
```
https://tile.loc.gov/image-services/iiif/{identifier}
```

**identifier 格式：** 使用冒号分隔的路径，如：
```
service:asian:lcnclscd:2014514163:1A000:00001a
```

**完整图片 URL 模式（IIIF Image API）：**
```
https://tile.loc.gov/image-services/iiif/{identifier}/{region}/{size}/{rotation}/{quality}.{format}
```

| 参数 | 可选值 | 说明 |
|------|--------|------|
| region | `full` | 完整图像 |
| size | `full`、`pct:100`、`pct:50`、`pct:25`、`pct:12.5` | 缩放比例 |
| rotation | `0`、`90`、`180`、`270` | 旋转角度（仅90度倍数） |
| quality | `default` | 默认质量 |
| format | `jpg` | JPEG 格式 |

**从详情页获取图片列表的流程：**

1. 请求 `https://www.loc.gov/item/{LCCN}/?fo=json`
2. 解析 `resources` 数组，每个元素代表一卷
3. 每卷的 `files` 是二维数组：`files[页码][分辨率版本]`
4. 每个文件对象包含：
   ```json
   {
     "height": 3220,
     "width": 1848,
     "levels": 6,
     "mimetype": "image/jpeg",
     "url": "https://tile.loc.gov/image-services/iiif/service:asian:lcnclscd:2014514163:1A000:00001a/full/pct:100/0/default.jpg",
     "info": "https://tile.loc.gov/image-services/iiif/service:asian:lcnclscd:2014514163:1A000:00001a/info.json"
   }
   ```
5. 每页有 6 种版本：JPEG（pct:12.5 / pct:25 / pct:50 / pct:100）、JP2 原始文件、TIFF 主文件
6. 选择 `mimetype: "image/jpeg"` 且 URL 含 `full/pct:100/` 的为最高质量 JPEG

### IIIF Presentation Manifest

LOC 不提供标准的 IIIF Presentation API manifest.json 端点。图片列表通过 LOC 自有的 JSON API（`?fo=json` 的 `resources` 字段）获取，而非标准 IIIF manifest。

页面上可能显示"Manifest (JSON-LD)"链接，但实际使用建议通过 `?fo=json&at=resources` 获取资源列表。

### bookget 支持

bookget 通过 `app/loc.go` 支持国会图书馆，注册域名 `www.loc.gov`。

**关键逻辑：**
1. 从 URL 提取 item ID：正则 `item/([A-Za-z0-9]+)`
2. 请求 JSON API：`https://www.loc.gov/item/{id}/?fo=json`
3. 解析 `resources[].files[][]` 二维数组获取图片列表
4. 遍历每页的多个文件版本，优先选择 `mimetype: "image/jpeg"` 且 URL 含 `full/pct:100/` 的版本
5. 支持自定义格式：可替换 URL 中的 `full/pct:...` 部分
6. Windows 环境下使用 bookget-gui 浏览器绕过真人验证（Cloudflare 等反爬机制）

**注意事项：**
- LOC 可能有 Cloudflare 等反爬保护，Windows 环境下 bookget 会启动 GUI 浏览器辅助
- Linux/macOS 下直接 HTTP 请求，需注意可能被拦截
- 需要设置 User-Agent 请求头
- 不需要 Cookie 或 Referer 验证
- 图片无水印

**相关源码：**
- https://github.com/deweizhu/bookget/blob/main/app/loc.go
- https://github.com/deweizhu/bookget/blob/main/model/loc/loc.go
